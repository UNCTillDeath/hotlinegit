!function(e,t){"function"==typeof define&&define.amd?define("p5.sound",["p5"],function(e){t(e)}):t("object"==typeof exports?require("../p5"):e.p5)}(this,function(p5){var sndcore;sndcore=function(){"use strict";!function(e,t,i){function n(e){e&&(e.setTargetAtTime||(e.setTargetAtTime=e.setTargetValueAtTime))}return t=t||{},window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")&&(window.AudioContext=webkitAudioContext,"function"!=typeof AudioContext.prototype.createGain&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),"function"!=typeof AudioContext.prototype.createDelay&&(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),"function"!=typeof AudioContext.prototype.createScriptProcessor&&(AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode),"function"!=typeof AudioContext.prototype.createPeriodicWave&&(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain,AudioContext.prototype.createGain=function(){var e=this.internal_createGain();return n(e.gain),e},AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay,AudioContext.prototype.createDelay=function(e){var t=e?this.internal_createDelay(e):this.internal_createDelay();return n(t.delayTime),t},AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource,AudioContext.prototype.createBufferSource=function(){var e=this.internal_createBufferSource();return e.start?(e.internal_start=e.start,e.start=function(t,i,n){"undefined"!=typeof n?e.internal_start(t||0,i,n):e.internal_start(t||0,i||0)}):e.start=function(e,t,i){t||i?this.noteGrainOn(e||0,t,i):this.noteOn(e||0)},e.stop?(e.internal_stop=e.stop,e.stop=function(t){e.internal_stop(t||0)}):e.stop=function(e){this.noteOff(e||0)},n(e.playbackRate),e},AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor,AudioContext.prototype.createDynamicsCompressor=function(){var e=this.internal_createDynamicsCompressor();return n(e.threshold),n(e.knee),n(e.ratio),n(e.reduction),n(e.attack),n(e.release),e},AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter,AudioContext.prototype.createBiquadFilter=function(){var e=this.internal_createBiquadFilter();return n(e.frequency),n(e.detune),n(e.Q),n(e.gain),e},"function"!=typeof AudioContext.prototype.createOscillator&&(AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator,AudioContext.prototype.createOscillator=function(){var e=this.internal_createOscillator();return e.start?(e.internal_start=e.start,e.start=function(t){e.internal_start(t||0)}):e.start=function(e){this.noteOn(e||0)},e.stop?(e.internal_stop=e.stop,e.stop=function(t){e.internal_stop(t||0)}):e.stop=function(e){this.noteOff(e||0)},e.setPeriodicWave||(e.setPeriodicWave=e.setWaveTable),n(e.frequency),n(e.detune),e})),window.hasOwnProperty("webkitOfflineAudioContext")&&!window.hasOwnProperty("OfflineAudioContext")&&(window.OfflineAudioContext=webkitOfflineAudioContext),t}(window);var e=new window.AudioContext;p5.prototype.getAudioContext=function(){return e},navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var t=document.createElement("audio");p5.prototype.isSupported=function(){return!!t.canPlayType};var i=function(){return!!t.canPlayType&&t.canPlayType('audio/ogg; codecs="vorbis"')},n=function(){return!!t.canPlayType&&t.canPlayType("audio/mpeg;")},r=function(){return!!t.canPlayType&&t.canPlayType('audio/wav; codecs="1"')},o=function(){return!!t.canPlayType&&(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;"))},a=function(){return!!t.canPlayType&&t.canPlayType("audio/x-aiff;")};p5.prototype.isFileSupported=function(e){switch(e.toLowerCase()){case"mp3":return n();case"wav":return r();case"ogg":return i();case"mp4":return o();case"aiff":return a();default:return!1}};var s=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;if(s){var l=!1,u=function(){if(!l){var t=e.createBuffer(1,1,22050),i=e.createBufferSource();i.buffer=t,i.connect(e.destination),i.start(0),console.log("start ios!"),"running"===e.state&&(l=!0)}};document.addEventListener("touchend",u,!1),document.addEventListener("touchstart",u,!1)}}();var master;master=function(){"use strict";var e=function(){var e=p5.prototype.getAudioContext();this.input=e.createGain(),this.output=e.createGain(),this.limiter=e.createDynamicsCompressor(),this.limiter.threshold.value=0,this.limiter.ratio.value=20,this.audiocontext=e,this.output.disconnect(),this.inputSources=[],this.input.connect(this.limiter),this.limiter.connect(this.output),this.meter=e.createGain(),this.fftMeter=e.createGain(),this.output.connect(this.meter),this.output.connect(this.fftMeter),this.output.connect(this.audiocontext.destination),this.soundArray=[],this.parts=[],this.extensions=[]},t=new e;return p5.prototype.getMasterVolume=function(){return t.output.gain.value},p5.prototype.masterVolume=function(e,i,n){if("number"==typeof e){var i=i||0,n=n||0,r=t.audiocontext.currentTime,o=t.output.gain.value;t.output.gain.cancelScheduledValues(r+n),t.output.gain.linearRampToValueAtTime(o,r+n),t.output.gain.linearRampToValueAtTime(e,r+n+i)}else{if(!e)return t.output.gain;e.connect(t.output.gain)}},p5.prototype.soundOut=p5.soundOut=t,p5.soundOut._silentNode=t.audiocontext.createGain(),p5.soundOut._silentNode.gain.value=0,p5.soundOut._silentNode.connect(t.audiocontext.destination),t}(sndcore);var helpers;helpers=function(){"use strict";var e=master;p5.prototype.sampleRate=function(){return e.audiocontext.sampleRate},p5.prototype.freqToMidi=function(e){var t=Math.log(e/440)/Math.log(2),i=Math.round(12*t)+57;return i},p5.prototype.midiToFreq=function(e){return 440*Math.pow(2,(e-69)/12)},p5.prototype.soundFormats=function(){e.extensions=[];for(var t=0;t<arguments.length;t++){if(arguments[t]=arguments[t].toLowerCase(),!(["mp3","wav","ogg","m4a","aac"].indexOf(arguments[t])>-1))throw arguments[t]+" is not a valid sound format!";e.extensions.push(arguments[t])}},p5.prototype.disposeSound=function(){for(var t=0;t<e.soundArray.length;t++)e.soundArray[t].dispose()},p5.prototype.registerMethod("remove",p5.prototype.disposeSound),p5.prototype._checkFileFormats=function(t){var i;if("string"==typeof t){i=t;var n=i.split(".").pop();if(["mp3","wav","ogg","m4a","aac"].indexOf(n)>-1){var r=p5.prototype.isFileSupported(n);if(r)i=i;else for(var o=i.split("."),a=o[o.length-1],s=0;s<e.extensions.length;s++){var l=e.extensions[s],r=p5.prototype.isFileSupported(l);if(r){a="",2===o.length&&(a+=o[0]);for(var s=1;s<=o.length-2;s++){var u=o[s];a+="."+u}i=a+=".",i=i+=l;break}}}else for(var s=0;s<e.extensions.length;s++){var l=e.extensions[s],r=p5.prototype.isFileSupported(l);if(r){i=i+"."+l;break}}}else if("object"==typeof t)for(var s=0;s<t.length;s++){var l=t[s].split(".").pop(),r=p5.prototype.isFileSupported(l);if(r){i=t[s];break}}return i},p5.prototype._mathChain=function(e,t,i,n,r){for(var o in e.mathOps)e.mathOps[o]instanceof r&&(e.mathOps[o].dispose(),i=o,i<e.mathOps.length-1&&(n=e.mathOps[o+1]));return e.mathOps[i-1].disconnect(),e.mathOps[i-1].connect(t),t.connect(n),e.mathOps[i]=t,e}}(master);var errorHandler;errorHandler=function(){"use strict";var e=function(e,t,i){var r,o,n=new Error;n.name=e,n.originalStack=n.stack+t,r=n.stack+t,n.failedPath=i;var o=r.split("\n");return o=o.filter(function(e){return!e.match(/(p5.|native code|globalInit)/g)}),n.stack=o.join("\n"),n};return e}();var panner;panner=function(){"use strict";var e=master,t=e.audiocontext;"undefined"!=typeof t.createStereoPanner?(p5.Panner=function(e,i,n){this.stereoPanner=this.input=t.createStereoPanner(),e.connect(this.stereoPanner),this.stereoPanner.connect(i)},p5.Panner.prototype.pan=function(e,i){var n=i||0,r=t.currentTime+n;this.stereoPanner.pan.linearRampToValueAtTime(e,r)},p5.Panner.prototype.inputChannels=function(e){},p5.Panner.prototype.connect=function(e){this.stereoPanner.connect(e)},p5.Panner.prototype.disconnect=function(e){this.stereoPanner.disconnect()}):(p5.Panner=function(e,i,n){this.input=t.createGain(),e.connect(this.input),this.left=t.createGain(),this.right=t.createGain(),this.left.channelInterpretation="discrete",this.right.channelInterpretation="discrete",n>1?(this.splitter=t.createChannelSplitter(2),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0)):(this.input.connect(this.left),this.input.connect(this.right)),this.output=t.createChannelMerger(2),this.left.connect(this.output,0,1),this.right.connect(this.output,0,0),this.output.connect(i)},p5.Panner.prototype.pan=function(e,i){var n=i||0,r=t.currentTime+n,o=(e+1)/2,a=Math.cos(o*Math.PI/2),s=Math.sin(o*Math.PI/2);this.left.gain.linearRampToValueAtTime(s,r),this.right.gain.linearRampToValueAtTime(a,r)},p5.Panner.prototype.inputChannels=function(e){1===e?(this.input.disconnect(),this.input.connect(this.left),this.input.connect(this.right)):2===e&&(this.splitter=t.createChannelSplitter(2),this.input.disconnect(),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0))},p5.Panner.prototype.connect=function(e){this.output.connect(e)},p5.Panner.prototype.disconnect=function(e){this.output.disconnect()}),p5.Panner3D=function(e,i){var n=t.createPanner();return n.panningModel="HRTF",n.distanceModel="linear",n.setPosition(0,0,0),e.connect(n),n.connect(i),n.pan=function(e,t,i){n.setPosition(e,t,i)},n}}(master);var soundfile;soundfile=function(){"use strict";function a(e,t){for(var i={},n=e.length,o=0;n>o;o++){if(e[o]>t){var a=e[o],s=new r(a,o);i[o]=s,o+=6e3}o++}return i}function s(e){for(var t=[],i=Object.keys(e).sort(),n=0;n<i.length;n++)for(var r=0;10>r;r++){var o=e[i[n]],a=e[i[n+r]];if(o&&a){var s=o.sampleIndex,l=a.sampleIndex,u=l-s;u>0&&o.intervals.push(u);var h=t.some(function(e,t){return e.interval===u?(e.count++,e):void 0});h||t.push({interval:u,count:1})}}return t}function l(e,t){var i=[];return e.forEach(function(e,n){try{var r=Math.abs(60/(e.interval/t));r=h(r);var o=i.some(function(t){return t.tempo===r?t.count+=e.count:void 0});if(!o){if(isNaN(r))return;i.push({tempo:Math.round(r),count:e.count})}}catch(a){throw a}}),i}function u(e,t,i,n){for(var r=[],o=Object.keys(e).sort(),a=0;a<o.length;a++)for(var s=o[a],l=e[s],u=0;u<l.intervals.length;u++){var c=Math.round(Math.abs(60/(l.intervals[u]/i)));c=h(c);Math.abs(c-t)<n&&r.push(l.sampleIndex/44100)}return r=r.filter(function(e,t,i){var n=i[t+1]-e;return n>.01?!0:void 0})}function h(e){if(isFinite(e)&&0!=e){for(;90>e;)e*=2;for(;e>180&&e>90;)e/=2;return e}}var e=errorHandler,t=master,i=t.audiocontext;p5.SoundFile=function(e,i,n,r){if("undefined"!=typeof e){if("string"==typeof e||"string"==typeof e[0]){var o=p5.prototype._checkFileFormats(e);this.url=o}else if("object"==typeof e&&!(window.File&&window.FileReader&&window.FileList&&window.Blob))throw"Unable to load file because the File API is not supported";e.file&&(e=e.file),this.file=e}this._onended=function(){},this._looping=!1,this._playing=!1,this._paused=!1,this._pauseTime=0,this._cues=[],this._lastPos=0,this._counterNode,this._scopeNode,this.bufferSourceNodes=[],this.bufferSourceNode=null,this.buffer=null,this.playbackRate=1,this.gain=1,this.input=t.audiocontext.createGain(),this.output=t.audiocontext.createGain(),this.reversed=!1,this.startTime=0,this.endTime=null,this.pauseTime=0,this.mode="sustain",this.startMillis=null,this.panPosition=0,this.panner=new p5.Panner(this.output,t.input,2),(this.url||this.file)&&this.load(i,n),t.soundArray.push(this),"function"==typeof r?this._whileLoading=r:this._whileLoading=function(){}},p5.prototype.registerPreloadMethod("loadSound",p5.prototype),p5.prototype.loadSound=function(e,t,i,n){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var r=new p5.SoundFile(e,t,i,n);return r},p5.SoundFile.prototype.load=function(t,n){var o=this,a=(new Error).stack;if(void 0!=this.url&&""!=this.url){var s=new XMLHttpRequest;s.addEventListener("progress",function(e){o._updateProgress(e)},!1),s.open("GET",this.url,!0),s.responseType="arraybuffer",s.onload=function(){if(200==s.status)i.decodeAudioData(s.response,function(e){o.buffer=e,o.panner.inputChannels(e.numberOfChannels),t&&t(o)},function(t){var i=new e("decodeAudioData",a,o.url),r="AudioContext error at decodeAudioData for "+o.url;n?(i.msg=r,n(i)):console.error(r+"\n The error stack trace includes: \n"+i.stack)});else{var r=new e("loadSound",a,o.url),l="Unable to load "+o.url+". The request status was: "+s.status+" ("+s.statusText+")";n?(r.message=l,n(r)):console.error(l+"\n The error stack trace includes: \n"+r.stack)}},s.onerror=function(t){var i=new e("loadSound",a,o.url),r="There was no response from the server at "+o.url+". Check the url and internet connectivity.";n?(i.message=r,n(i)):console.error(r+"\n The error stack trace includes: \n"+i.stack)},s.send()}else if(void 0!=this.file){var l=new FileReader,o=this;l.onload=function(){i.decodeAudioData(l.result,function(e){o.buffer=e,o.panner.inputChannels(e.numberOfChannels),t&&t(o)})},l.onerror=function(e){onerror&&onerror(e)},l.readAsArrayBuffer(this.file)}},p5.SoundFile.prototype._updateProgress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*.99;this._whileLoading(t,e)}else this._whileLoading("size unknown")},p5.SoundFile.prototype.isLoaded=function(){return this.buffer?!0:!1},p5.SoundFile.prototype.play=function(e,i,n,r,o){var l,u,a=this,s=t.audiocontext.currentTime,e=e||0;if(0>e&&(e=0),e+=s,!this.buffer)throw"not ready to play file, buffer has yet to load. Try preload()";if(this._pauseTime=0,"restart"===this.mode&&this.buffer&&this.bufferSourceNode){var s=t.audiocontext.currentTime;this.bufferSourceNode.stop(e),this._counterNode.stop(e)}if(i&&(this.playbackRate=i),this.bufferSourceNode=this._initSourceNode(),this._counterNode&&(this._counterNode=void 0),this._counterNode=this._initCounterNode(),r){if(!(r>=0&&r<this.buffer.duration))throw"start time out of range";l=r}else l=0;o=o?o<=this.buffer.duration-l?o:this.buffer.duration:this.buffer.duration-l;var h=n||1;this.bufferSourceNode.connect(this.output),this.output.gain.value=h,this._paused?(this.bufferSourceNode.start(e,this.pauseTime,o),this._counterNode.start(e,this.pauseTime,o)):(this.bufferSourceNode.start(e,l,o),this._counterNode.start(e,l,o)),this._playing=!0,this._paused=!1,this.bufferSourceNodes.push(this.bufferSourceNode),this.bufferSourceNode._arrayIndex=this.bufferSourceNodes.length-1;var c=function(e){this._playing=!1,this.removeEventListener("ended",c,!1),a._onended(a),a.bufferSourceNodes.forEach(function(e,t){e._playing===!1&&a.bufferSourceNodes.splice(t)}),0===a.bufferSourceNodes.length&&(a._playing=!1)};if(this.bufferSourceNode.onended=c,this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping,this._looping===!0){var u=l+o;this.bufferSourceNode.loopStart=l,this.bufferSourceNode.loopEnd=u,this._counterNode.loopStart=l,this._counterNode.loopEnd=u}},p5.SoundFile.prototype.playMode=function(e){var i=e.toLowerCase();if("restart"===i&&this.buffer&&this.bufferSourceNode)for(var n=0;n<this.bufferSourceNodes.length-1;n++){var r=t.audiocontext.currentTime;this.bufferSourceNodes[n].stop(r)}if("restart"!==i&&"sustain"!==i)throw'Invalid play mode. Must be either "restart" or "sustain"';this.mode=i},p5.SoundFile.prototype.pause=function(e){var i=t.audiocontext.currentTime,e=e||0,n=e+i;this.isPlaying()&&this.buffer&&this.bufferSourceNode?(this.pauseTime=this.currentTime(),this.bufferSourceNode.stop(n),this._counterNode.stop(n),this._paused=!0,this._playing=!1,this._pauseTime=this.currentTime()):this._pauseTime=0},p5.SoundFile.prototype.loop=function(e,t,i,n,r){this._looping=!0,this.play(e,t,i,n,r)},p5.SoundFile.prototype.setLoop=function(e){if(e===!0)this._looping=!0;else{if(e!==!1)throw"Error: setLoop accepts either true or false";this._looping=!1}this.bufferSourceNode&&(this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping)},p5.SoundFile.prototype.isLooping=function(){return this.bufferSourceNode&&this._looping===!0&&this.isPlaying()===!0?!0:!1},p5.SoundFile.prototype.isPlaying=function(){return this._playing},p5.SoundFile.prototype.isPaused=function(){return this._paused},p5.SoundFile.prototype.stop=function(e){var i=e||0;if("sustain"==this.mode)this.stopAll(i),this._playing=!1,this.pauseTime=0,this._paused=!1;else if(this.buffer&&this.bufferSourceNode){var n=t.audiocontext.currentTime,r=i||0;this.pauseTime=0,this.bufferSourceNode.stop(n+r),this._counterNode.stop(n+r),this._playing=!1,this._paused=!1}},p5.SoundFile.prototype.stopAll=function(e){var i=t.audiocontext.currentTime,n=e||0;if(this.buffer&&this.bufferSourceNode){for(var r=0;r<this.bufferSourceNodes.length;r++)if(void 0!=typeof this.bufferSourceNodes[r])try{this.bufferSourceNodes[r].onended=function(){},this.bufferSourceNodes[r].stop(i+n)}catch(o){}this._counterNode.stop(i+n),this._onended(this)}},p5.SoundFile.prototype.setVolume=function(e,i,n){if("number"==typeof e){var i=i||0,n=n||0,r=t.audiocontext.currentTime,o=this.output.gain.value;this.output.gain.cancelScheduledValues(r+n),this.output.gain.linearRampToValueAtTime(o,r+n),this.output.gain.linearRampToValueAtTime(e,r+n+i)}else{if(!e)return this.output.gain;e.connect(this.output.gain)}},p5.SoundFile.prototype.amp=p5.SoundFile.prototype.setVolume,p5.SoundFile.prototype.fade=p5.SoundFile.prototype.setVolume,p5.SoundFile.prototype.getVolume=function(){return this.output.gain.value},p5.SoundFile.prototype.pan=function(e,t){this.panPosition=e,this.panner.pan(e,t)},p5.SoundFile.prototype.getPan=function(){return this.panPosition},p5.SoundFile.prototype.rate=function(e){if(this.playbackRate!==e||!this.bufferSourceNode||this.bufferSourceNode.playbackRate.value!==e){this.playbackRate=e;var i=e;if(0===this.playbackRate&&this._playing&&this.pause(),this.playbackRate<0&&!this.reversed){var n=this.currentTime();this.bufferSourceNode.playbackRate.value;this.reverseBuffer(),i=Math.abs(e);var o=(n-this.duration())/i;this.pauseTime=o}else this.playbackRate>0&&this.reversed&&this.reverseBuffer();if(this.bufferSourceNode){var a=t.audiocontext.currentTime;this.bufferSourceNode.playbackRate.cancelScheduledValues(a),this.bufferSourceNode.playbackRate.linearRampToValueAtTime(Math.abs(i),a),this._counterNode.playbackRate.cancelScheduledValues(a),this._counterNode.playbackRate.linearRampToValueAtTime(Math.abs(i),a)}}},p5.SoundFile.prototype.setPitch=function(e){var t=midiToFreq(e)/midiToFreq(60);this.rate(t)},p5.SoundFile.prototype.getPlaybackRate=function(){return this.playbackRate},p5.SoundFile.prototype.duration=function(){return this.buffer?this.buffer.duration:0},p5.SoundFile.prototype.currentTime=function(){return this._pauseTime>0?this._pauseTime:this._lastPos/i.sampleRate},p5.SoundFile.prototype.jump=function(e,t){if(0>e||e>this.buffer.duration)throw"jump time out of range";if(t>this.buffer.duration-e)throw"end time out of range";var i=e||0,n=t||this.buffer.duration-e;this.isPlaying()&&this.stop(),this.play(0,this.playbackRate,this.output.gain.value,i,n)},p5.SoundFile.prototype.channels=function(){return this.buffer.numberOfChannels},p5.SoundFile.prototype.sampleRate=function(){return this.buffer.sampleRate},p5.SoundFile.prototype.frames=function(){return this.buffer.length},p5.SoundFile.prototype.getPeaks=function(e){if(!this.buffer)throw"Cannot load peaks yet, buffer is not loaded";if(e||(e=5*window.width),this.buffer){for(var t=this.buffer,i=t.length/e,n=~~(i/10)||1,r=t.numberOfChannels,o=new Float32Array(Math.round(e)),a=0;r>a;a++)for(var s=t.getChannelData(a),l=0;e>l;l++){for(var u=~~(l*i),h=~~(u+i),c=0,f=u;h>f;f+=n){var p=s[f];p>c?c=p:-p>c&&(c=p)}(0===a||Math.abs(c)>o[l])&&(o[l]=c)}return o}},p5.SoundFile.prototype.reverseBuffer=function(){var e=this.getVolume();if(this.setVolume(0,.01,0),this.pause(),!this.buffer)throw"SoundFile is not done loading";for(var t=0;t<this.buffer.numberOfChannels;t++)Array.prototype.reverse.call(this.buffer.getChannelData(t));this.reversed=!this.reversed,this.setVolume(e,.01,.0101),this.play()},p5.SoundFile.prototype.onended=function(e){return this._onended=e,this},p5.SoundFile.prototype.add=function(){},p5.SoundFile.prototype.dispose=function(){var e=t.audiocontext.currentTime,i=t.soundArray.indexOf(this);if(t.soundArray.splice(i,1),this.stop(e),this.buffer&&this.bufferSourceNode){for(var n=0;n<this.bufferSourceNodes.length-1;n++)if(null!==this.bufferSourceNodes[n]){this.bufferSourceNodes[n].disconnect();try{this.bufferSourceNodes[n].stop(e)}catch(r){}this.bufferSourceNodes[n]=null}if(this.isPlaying()){try{this._counterNode.stop(e)}catch(r){console.log(r)}this._counterNode=null}}this.output&&(this.output.disconnect(),this.output=null),this.panner&&(this.panner.disconnect(),this.panner=null)},p5.SoundFile.prototype.connect=function(e){e?e.hasOwnProperty("input")?this.panner.connect(e.input):this.panner.connect(e):this.panner.connect(t.input)},p5.SoundFile.prototype.disconnect=function(){this.panner.disconnect()},p5.SoundFile.prototype.getLevel=function(e){console.warn("p5.SoundFile.getLevel has been removed from the library. Use p5.Amplitude instead")},p5.SoundFile.prototype.setPath=function(e,t){var i=p5.prototype._checkFileFormats(e);this.url=i,this.load(t)},p5.SoundFile.prototype.setBuffer=function(e){var t=e.length,n=e[0].length,r=i.createBuffer(t,n,i.sampleRate);!e[0]instanceof Float32Array&&(e[0]=new Float32Array(e[0]));for(var o=0;t>o;o++){var a=r.getChannelData(o);a.set(e[o])}this.buffer=r,this.panner.inputChannels(t)},p5.SoundFile.prototype._initCounterNode=function(){var e=this,t=i.currentTime,r=i.createBufferSource();return e._scopeNode&&(e._scopeNode.disconnect(),e._scopeNode.onaudioprocess=void 0,e._scopeNode=null),e._scopeNode=i.createScriptProcessor(256,1,1),r.buffer=n(e.buffer),r.playbackRate.setValueAtTime(e.playbackRate,t),r.connect(e._scopeNode),e._scopeNode.connect(p5.soundOut._silentNode),e._scopeNode.onaudioprocess=function(t){var i=t.inputBuffer.getChannelData(0);e._lastPos=i[i.length-1]||0,e._onTimeUpdate(e._lastPos)},r},p5.SoundFile.prototype._initSourceNode=function(){var e=this,n=(i.currentTime,i.createBufferSource());return n.buffer=e.buffer,n.playbackRate.value=e.playbackRate,n};var n=function(e){for(var t=new Float32Array(e.length),n=i.createBuffer(1,e.length,44100),r=0;r<e.length;r++)t[r]=r;return n.getChannelData(0).set(t),n};p5.SoundFile.prototype.processPeaks=function(e,t,i,n){var r=this.buffer.length,h=this.buffer.sampleRate,c=this.buffer,f=t||.9,p=f,d=i||.22,m=n||200,v=new OfflineAudioContext(1,r,h),g=v.createBufferSource();g.buffer=c;var y=v.createBiquadFilter();y.type="lowpass",g.connect(y),y.connect(v.destination),g.start(0),v.startRendering(),v.oncomplete=function(t){var n=t.renderedBuffer,r=n.getChannelData(0);do o=a(r,p),p-=.005;while(Object.keys(o).length<m&&p>=d);var h=s(o),c=l(h,n.sampleRate),f=c.sort(function(e,t){return t.count-e.count}).splice(0,5);this.tempo=f[0].tempo;var v=5,g=u(o,f[0].tempo,n.sampleRate,v);e(g)}};var r=function(e,t){this.sampleIndex=t,this.amplitude=e,this.tempos=[],this.intervals=[]},o=[];p5.SoundFile.prototype.addCue=function(e,t,i){var n=this._cueIDCounter++,r=new c(t,e,n,i);return this._cues.push(r),n},p5.SoundFile.prototype.removeCue=function(e){for(var t=this._cues.length,i=0;t>i;i++){var n=this._cues[i];n.id===e&&this.cues.splice(i,1)}0===this._cues.length},p5.SoundFile.prototype.clearCues=function(){this._cues=[]},p5.SoundFile.prototype._onTimeUpdate=function(e){for(var t=e/this.buffer.sampleRate,i=this._cues.length,n=0;i>n;n++){var r=this._cues[n],o=r.time,a=r.val;this._prevTime<o&&t>=o&&r.callback(a)}this._prevTime=t};var c=function(e,t,i,n){this.callback=e,this.time=t,this.id=i,this.val=n}}(sndcore,errorHandler,master);var amplitude;amplitude=function(){"use strict";var e=master;p5.Amplitude=function(t){this.bufferSize=2048,this.audiocontext=e.audiocontext,this.processor=this.audiocontext.createScriptProcessor(this.bufferSize,2,1),this.input=this.processor,this.output=this.audiocontext.createGain(),this.smoothing=t||0,this.volume=0,this.average=0,this.stereoVol=[0,0],this.stereoAvg=[0,0],this.stereoVolNorm=[0,0],this.volMax=.001,this.normalize=!1,this.processor.onaudioprocess=this._audioProcess.bind(this),this.processor.connect(this.output),this.output.gain.value=0,this.output.connect(this.audiocontext.destination),e.meter.connect(this.processor),e.soundArray.push(this)},p5.Amplitude.prototype.setInput=function(t,i){e.meter.disconnect(),i&&(this.smoothing=i),null==t?(console.log("Amplitude input source is not ready! Connecting to master output instead"),e.meter.connect(this.processor)):t instanceof p5.Signal?t.output.connect(this.processor):t?(t.connect(this.processor),this.processor.disconnect(),this.processor.connect(this.output)):e.meter.connect(this.processor)},p5.Amplitude.prototype.connect=function(t){t?t.hasOwnProperty("input")?this.output.connect(t.input):this.output.connect(t):this.output.connect(this.panner.connect(e.input))},p5.Amplitude.prototype.disconnect=function(e){this.output.disconnect()},p5.Amplitude.prototype._audioProcess=function(e){for(var t=0;t<e.inputBuffer.numberOfChannels;t++){for(var a,i=e.inputBuffer.getChannelData(t),n=i.length,r=0,o=0,s=0;n>s;s++)a=i[s],this.normalize?(r+=Math.max(Math.min(a/this.volMax,1),-1),o+=Math.max(Math.min(a/this.volMax,1),-1)*Math.max(Math.min(a/this.volMax,1),-1)):(r+=a,o+=a*a);var l=r/n,u=Math.sqrt(o/n);this.stereoVol[t]=Math.max(u,this.stereoVol[t]*this.smoothing),this.stereoAvg[t]=Math.max(l,this.stereoVol[t]*this.smoothing),this.volMax=Math.max(this.stereoVol[t],this.volMax)}var h=this,c=this.stereoVol.reduce(function(e,t,i){return h.stereoVolNorm[i-1]=Math.max(Math.min(h.stereoVol[i-1]/h.volMax,1),0),h.stereoVolNorm[i]=Math.max(Math.min(h.stereoVol[i]/h.volMax,1),0),e+t});this.volume=c/this.stereoVol.length,this.volNorm=Math.max(Math.min(this.volume/this.volMax,1),0)},p5.Amplitude.prototype.getLevel=function(e){return"undefined"!=typeof e?this.normalize?this.stereoVolNorm[e]:this.stereoVol[e]:this.normalize?this.volNorm:this.volume},p5.Amplitude.prototype.toggleNormalize=function(e){"boolean"==typeof e?this.normalize=e:this.normalize=!this.normalize},p5.Amplitude.prototype.smooth=function(e){e>=0&&1>e?this.smoothing=e:console.log("Error: smoothing must be between 0 and 1")},p5.Amplitude.prototype.dispose=function(){var t=e.soundArray.indexOf(this);e.soundArray.splice(t,1),this.input.disconnect(),this.output.disconnect(),this.input=this.processor=void 0,this.output=void 0}}(master);var fft;fft=function(){"use strict";var e=master;p5.FFT=function(t,i){this.smoothing=t||.8,this.bins=i||1024;var n=2*i||2048;this.input=this.analyser=e.audiocontext.createAnalyser(),e.fftMeter.connect(this.analyser),this.analyser.smoothingTimeConstant=this.smoothing,this.analyser.fftSize=n,this.freqDomain=new Uint8Array(this.analyser.frequencyBinCount),this.timeDomain=new Uint8Array(this.analyser.frequencyBinCount),this.bass=[20,140],this.lowMid=[140,400],this.mid=[400,2600],this.highMid=[2600,5200],this.treble=[5200,14e3],e.soundArray.push(this)},p5.FFT.prototype.setInput=function(t){t?(t.output?t.output.connect(this.analyser):t.connect&&t.connect(this.analyser),e.fftMeter.disconnect()):e.fftMeter.connect(this.analyser)},p5.FFT.prototype.waveform=function(){for(var e,t,i,o=0;o<arguments.length;o++)"number"==typeof arguments[o]&&(e=arguments[o],this.analyser.fftSize=2*e),"string"==typeof arguments[o]&&(t=arguments[o]);if(t&&!p5.prototype._isSafari())return n(this,this.timeDomain),this.analyser.getFloatTimeDomainData(this.timeDomain),this.timeDomain;r(this,this.timeDomain),this.analyser.getByteTimeDomainData(this.timeDomain);for(var i=new Array,o=0;o<this.timeDomain.length;o++){var a=p5.prototype.map(this.timeDomain[o],0,255,-1,1);i.push(a)}return i},p5.FFT.prototype.analyze=function(){for(var e,n,r=0;r<arguments.length;r++)"number"==typeof arguments[r]&&(e=this.bins=arguments[r],this.analyser.fftSize=2*this.bins),"string"==typeof arguments[r]&&(n=arguments[r]);if(n&&"db"===n.toLowerCase())return t(this),this.analyser.getFloatFrequencyData(this.freqDomain),this.freqDomain;i(this,this.freqDomain),this.analyser.getByteFrequencyData(this.freqDomain);var o=Array.apply([],this.freqDomain);return o.length===this.analyser.fftSize,o.constructor===Array,o},p5.FFT.prototype.getEnergy=function(t,i){var n=e.audiocontext.sampleRate/2;if("bass"===t?(t=this.bass[0],i=this.bass[1]):"lowMid"===t?(t=this.lowMid[0],i=this.lowMid[1]):"mid"===t?(t=this.mid[0],i=this.mid[1]):"highMid"===t?(t=this.highMid[0],i=this.highMid[1]):"treble"===t&&(t=this.treble[0],i=this.treble[1]),"number"!=typeof t)throw"invalid input for getEnergy()";if(i){if(t&&i){if(t>i){var o=i;i=t,t=o}for(var a=Math.round(t/n*this.freqDomain.length),s=Math.round(i/n*this.freqDomain.length),l=0,u=0,h=a;s>=h;h++)l+=this.freqDomain[h],u+=1;var c=l/u;return c}throw"invalid input for getEnergy()"}var r=Math.round(t/n*this.freqDomain.length);return this.freqDomain[r]},p5.FFT.prototype.getFreq=function(e,t){console.log("getFreq() is deprecated. Please use getEnergy() instead.");var i=this.getEnergy(e,t);return i},p5.FFT.prototype.getCentroid=function(){for(var t=e.audiocontext.sampleRate/2,i=0,n=0,r=0;r<this.freqDomain.length;r++)i+=r*this.freqDomain[r],n+=this.freqDomain[r];var o=0;0!=n&&(o=i/n);var a=o*(t/this.freqDomain.length);return a},p5.FFT.prototype.smooth=function(e){e&&(this.smoothing=e),this.analyser.smoothingTimeConstant=e},p5.FFT.prototype.dispose=function(){var t=e.soundArray.indexOf(this);e.soundArray.splice(t,1),this.analyser.disconnect(),this.analyser=void 0},p5.FFT.prototype.linAverages=function(e){for(var e=e||16,t=this.freqDomain,i=t.length,n=Math.floor(i/e),r=new Array(e),o=0,a=0;i>a;a++)r[o]=void 0!==r[o]?(r[o]+t[a])/2:t[a],a%n==n-1&&o++;return r},p5.FFT.prototype.logAverages=function(t){for(var i=e.audiocontext.sampleRate/2,n=this.freqDomain,r=n.length,o=new Array(t.length),a=0,s=0;r>s;s++){var l=Math.round(s*i/this.freqDomain.length);l>t[a].hi&&a++,o[a]=void 0!==o[a]?(o[a]+n[s])/2:n[s]}return o},p5.FFT.prototype.getOctaveBands=function(t,i){var t=t||3,i=i||15.625,n=[],r={lo:i/Math.pow(2,1/(2*t)),ctr:i,hi:i*Math.pow(2,1/(2*t))};n.push(r);for(var o=e.audiocontext.sampleRate/2;r.hi<o;){var a={};a.lo=r.hi,a.ctr=r.ctr*Math.pow(2,1/t),a.hi=a.ctr*Math.pow(2,1/(2*t)),n.push(a),r=a}return n};var t=function(e){e.freqDomain instanceof Float32Array==!1&&(e.freqDomain=new Float32Array(e.analyser.frequencyBinCount))},i=function(e){e.freqDomain instanceof Uint8Array==!1&&(e.freqDomain=new Uint8Array(e.analyser.frequencyBinCount))},n=function(e){e.timeDomain instanceof Float32Array==!1&&(e.timeDomain=new Float32Array(e.analyser.frequencyBinCount))},r=function(e){e.timeDomain instanceof Uint8Array==!1&&(e.timeDomain=new Uint8Array(e.analyser.frequencyBinCount))}}(master);var Tone_core_Tone;Tone_core_Tone=function(){"use strict";function e(e){return void 0===e}function t(e){return"function"==typeof e}var i;if(e(window.AudioContext)&&(window.AudioContext=window.webkitAudioContext),e(window.OfflineAudioContext)&&(window.OfflineAudioContext=window.webkitOfflineAudioContext),e(AudioContext))throw new Error("Web Audio is not supported in this browser");i=new AudioContext,t(AudioContext.prototype.createGain)||(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),t(AudioContext.prototype.createDelay)||(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),t(AudioContext.prototype.createPeriodicWave)||(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),t(AudioBufferSourceNode.prototype.start)||(AudioBufferSourceNode.prototype.start=AudioBufferSourceNode.prototype.noteGrainOn),t(AudioBufferSourceNode.prototype.stop)||(AudioBufferSourceNode.prototype.stop=AudioBufferSourceNode.prototype.noteOff),
t(OscillatorNode.prototype.start)||(OscillatorNode.prototype.start=OscillatorNode.prototype.noteOn),t(OscillatorNode.prototype.stop)||(OscillatorNode.prototype.stop=OscillatorNode.prototype.noteOff),t(OscillatorNode.prototype.setPeriodicWave)||(OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable),AudioNode.prototype._nativeConnect=AudioNode.prototype.connect,AudioNode.prototype.connect=function(t,i,n){if(t.input)Array.isArray(t.input)?(e(n)&&(n=0),this.connect(t.input[n])):this.connect(t.input,i,n);else try{t instanceof AudioNode?this._nativeConnect(t,i,n):this._nativeConnect(t,i)}catch(r){throw new Error("error connecting to node: "+t)}};var n=function(t,i){e(t)||1===t?this.input=this.context.createGain():t>1&&(this.input=new Array(t)),e(i)||1===i?this.output=this.context.createGain():i>1&&(this.output=new Array(t))};n.prototype.set=function(t,i,r){if(this.isObject(t))r=i;else if(this.isString(t)){var o={};o[t]=i,t=o}for(var a in t){i=t[a];var s=this;if(-1!==a.indexOf(".")){for(var l=a.split("."),u=0;u<l.length-1;u++)s=s[l[u]];a=l[l.length-1]}var h=s[a];e(h)||(n.Signal&&h instanceof n.Signal||n.Param&&h instanceof n.Param?h.value!==i&&(e(r)?h.value=i:h.rampTo(i,r)):h instanceof AudioParam?h.value!==i&&(h.value=i):h instanceof n?h.set(i):h!==i&&(s[a]=i))}return this},n.prototype.get=function(i){e(i)?i=this._collectDefaults(this.constructor):this.isString(i)&&(i=[i]);for(var r={},o=0;o<i.length;o++){var a=i[o],s=this,l=r;if(-1!==a.indexOf(".")){for(var u=a.split("."),h=0;h<u.length-1;h++){var c=u[h];l[c]=l[c]||{},l=l[c],s=s[c]}a=u[u.length-1]}var f=s[a];this.isObject(i[a])?l[a]=f.get():n.Signal&&f instanceof n.Signal?l[a]=f.value:n.Param&&f instanceof n.Param?l[a]=f.value:f instanceof AudioParam?l[a]=f.value:f instanceof n?l[a]=f.get():t(f)||e(f)||(l[a]=f)}return r},n.prototype._collectDefaults=function(t){var i=[];if(e(t.defaults)||(i=Object.keys(t.defaults)),!e(t._super))for(var n=this._collectDefaults(t._super),r=0;r<n.length;r++)-1===i.indexOf(n[r])&&i.push(n[r]);return i},n.prototype.toString=function(){for(var e in n){var i=e[0].match(/^[A-Z]$/),r=n[e]===this.constructor;if(t(n[e])&&i&&r)return e}return"Tone"},n.context=i,n.prototype.context=n.context,n.prototype.bufferSize=2048,n.prototype.blockTime=128/n.context.sampleRate,n.prototype.dispose=function(){return this.isUndef(this.input)||(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),this.isUndef(this.output)||(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this};var r=null;n.prototype.noGC=function(){return this.output.connect(r),this},AudioNode.prototype.noGC=function(){return this.connect(r),this},n.prototype.connect=function(e,t,i){return Array.isArray(this.output)?(t=this.defaultArg(t,0),this.output[t].connect(e,0,i)):this.output.connect(e,t,i),this},n.prototype.disconnect=function(e){return Array.isArray(this.output)?(e=this.defaultArg(e,0),this.output[e].disconnect()):this.output.disconnect(),this},n.prototype.connectSeries=function(){if(arguments.length>1)for(var e=arguments[0],t=1;t<arguments.length;t++){var i=arguments[t];e.connect(i),e=i}return this},n.prototype.connectParallel=function(){var e=arguments[0];if(arguments.length>1)for(var t=1;t<arguments.length;t++){var i=arguments[t];e.connect(i)}return this},n.prototype.chain=function(){if(arguments.length>0)for(var e=this,t=0;t<arguments.length;t++){var i=arguments[t];e.connect(i),e=i}return this},n.prototype.fan=function(){if(arguments.length>0)for(var e=0;e<arguments.length;e++)this.connect(arguments[e]);return this},AudioNode.prototype.chain=n.prototype.chain,AudioNode.prototype.fan=n.prototype.fan,n.prototype.defaultArg=function(t,i){if(this.isObject(t)&&this.isObject(i)){var n={};for(var r in t)n[r]=this.defaultArg(i[r],t[r]);for(var o in i)n[o]=this.defaultArg(t[o],i[o]);return n}return e(t)?i:t},n.prototype.optionsObject=function(e,t,i){var n={};if(1===e.length&&this.isObject(e[0]))n=e[0];else for(var r=0;r<t.length;r++)n[t[r]]=e[r];return this.isUndef(i)?n:this.defaultArg(n,i)},n.prototype.isUndef=e,n.prototype.isFunction=t,n.prototype.isNumber=function(e){return"number"==typeof e},n.prototype.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)&&e.constructor===Object},n.prototype.isBoolean=function(e){return"boolean"==typeof e},n.prototype.isArray=function(e){return Array.isArray(e)},n.prototype.isString=function(e){return"string"==typeof e},n.noOp=function(){},n.prototype._readOnly=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this._readOnly(e[t]);else Object.defineProperty(this,e,{writable:!1,enumerable:!0})},n.prototype._writable=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this._writable(e[t]);else Object.defineProperty(this,e,{writable:!0})},n.State={Started:"started",Stopped:"stopped",Paused:"paused"},n.prototype.equalPowerScale=function(e){var t=.5*Math.PI;return Math.sin(e*t)},n.prototype.dbToGain=function(e){return Math.pow(2,e/6)},n.prototype.gainToDb=function(e){return 20*(Math.log(e)/Math.LN10)},n.prototype.now=function(){return this.context.currentTime},n.extend=function(t,i){function r(){}e(i)&&(i=n),r.prototype=i.prototype,t.prototype=new r,t.prototype.constructor=t,t._super=i};var o=[];return n._initAudioContext=function(e){e(n.context),o.push(e)},n.setContext=function(e){n.prototype.context=e,n.context=e;for(var t=0;t<o.length;t++)o[t](e)},n.startMobile=function(){var e=n.context.createOscillator(),t=n.context.createGain();t.gain.value=0,e.connect(t),t.connect(n.context.destination);var i=n.context.currentTime;e.start(i),e.stop(i+1)},n._initAudioContext(function(e){n.prototype.blockTime=128/e.sampleRate,r=e.createGain(),r.gain.value=0,r.connect(e.destination)}),n.version="r7-dev",n}();var Tone_signal_SignalBase;Tone_signal_SignalBase=function(e){"use strict";return e.SignalBase=function(){},e.extend(e.SignalBase),e.SignalBase.prototype.connect=function(t,i,n){return e.Signal&&e.Signal===t.constructor||e.Param&&e.Param===t.constructor||e.TimelineSignal&&e.TimelineSignal===t.constructor?(t._param.cancelScheduledValues(0),t._param.value=0,t.overridden=!0):t instanceof AudioParam&&(t.cancelScheduledValues(0),t.value=0),e.prototype.connect.call(this,t,i,n),this},e.SignalBase}(Tone_core_Tone);var Tone_signal_WaveShaper;Tone_signal_WaveShaper=function(e){"use strict";return e.WaveShaper=function(e,t){this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(e)?this.curve=e:isFinite(e)||this.isUndef(e)?this._curve=new Float32Array(this.defaultArg(e,1024)):this.isFunction(e)&&(this._curve=new Float32Array(this.defaultArg(t,1024)),this.setMap(e))},e.extend(e.WaveShaper,e.SignalBase),e.WaveShaper.prototype.setMap=function(e){for(var t=0,i=this._curve.length;i>t;t++){var n=t/i*2-1;this._curve[t]=e(n,t)}return this._shaper.curve=this._curve,this},Object.defineProperty(e.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(e){this._curve=new Float32Array(e),this._shaper.curve=this._curve}}),Object.defineProperty(e.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(e){if(-1===["none","2x","4x"].indexOf(e))throw new Error("invalid oversampling: "+e);this._shaper.oversample=e}}),e.WaveShaper.prototype.dispose=function(){return e.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},e.WaveShaper}(Tone_core_Tone);var Tone_core_Type;Tone_core_Type=function(Tone){"use strict";function getTransportBpm(){return Tone.Transport&&Tone.Transport.bpm?Tone.Transport.bpm.value:120}function getTransportTimeSignature(){return Tone.Transport&&Tone.Transport.timeSignature?Tone.Transport.timeSignature:4}function toNotationHelper(e,t,i,n){for(var r=this.toSeconds(e),o=this.notationToSeconds(n[n.length-1],t,i),a="",s=0;s<n.length;s++){var l=this.notationToSeconds(n[s],t,i),u=r/l,h=1e-6;if(h>1-u%1&&(u+=h),u=Math.floor(u),u>0){if(a+=1===u?n[s]:u.toString()+"*"+n[s],r-=u*l,o>r)break;a+=" + "}}return""===a&&(a="0"),a}Tone.Type={Default:"number",Time:"time",Frequency:"frequency",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Cents:"cents",Degrees:"degrees",MIDI:"midi",TransportTime:"transportTime",Ticks:"tick",Note:"note",Milliseconds:"milliseconds",Notation:"notation"},Tone.prototype.isNowRelative=function(){var e=new RegExp(/^\s*\+(.)+/i);return function(t){return e.test(t)}}(),Tone.prototype.isTicks=function(){var e=new RegExp(/^\d+i$/i);return function(t){return e.test(t)}}(),Tone.prototype.isNotation=function(){var e=new RegExp(/^[0-9]+[mnt]$/i);return function(t){return e.test(t)}}(),Tone.prototype.isTransportTime=function(){var e=new RegExp(/^(\d+(\.\d+)?\:){1,2}(\d+(\.\d+)?)?$/i);return function(t){return e.test(t)}}(),Tone.prototype.isNote=function(){var e=new RegExp(/^[a-g]{1}(b|#|x|bb)?-?[0-9]+$/i);return function(t){return e.test(t)}}(),Tone.prototype.isFrequency=function(){var e=new RegExp(/^\d*\.?\d+hz$/i);return function(t){return e.test(t)}}(),Tone.prototype.notationToSeconds=function(e,t,i){t=this.defaultArg(t,getTransportBpm()),i=this.defaultArg(i,getTransportTimeSignature());var n=60/t;"1n"===e&&(e="1m");var r=parseInt(e,10),o=0;0===r&&(o=0);var a=e.slice(-1);return o="t"===a?4/r*2/3:"n"===a?4/r:"m"===a?r*i:0,n*o},Tone.prototype.transportTimeToSeconds=function(e,t,i){t=this.defaultArg(t,getTransportBpm()),i=this.defaultArg(i,getTransportTimeSignature());var n=0,r=0,o=0,a=e.split(":");2===a.length?(n=parseFloat(a[0]),r=parseFloat(a[1])):1===a.length?r=parseFloat(a[0]):3===a.length&&(n=parseFloat(a[0]),r=parseFloat(a[1]),o=parseFloat(a[2]));var s=n*i+r+o/4;return s*(60/t)},Tone.prototype.ticksToSeconds=function(e,t){if(this.isUndef(Tone.Transport))return 0;e=parseFloat(e),t=this.defaultArg(t,getTransportBpm());var i=60/t/Tone.Transport.PPQ;return i*e},Tone.prototype.frequencyToSeconds=function(e){return 1/parseFloat(e)},Tone.prototype.samplesToSeconds=function(e){return e/this.context.sampleRate},Tone.prototype.secondsToSamples=function(e){return e*this.context.sampleRate},Tone.prototype.secondsToTransportTime=function(e,t,i){t=this.defaultArg(t,getTransportBpm()),i=this.defaultArg(i,getTransportTimeSignature());var n=60/t,r=e/n,o=Math.floor(r/i),a=r%1*4;r=Math.floor(r)%i;var s=[o,r,a];return s.join(":")},Tone.prototype.secondsToFrequency=function(e){return 1/e},Tone.prototype.toTransportTime=function(e,t,i){var n=this.toSeconds(e);return this.secondsToTransportTime(n,t,i)},Tone.prototype.toFrequency=function(e,t){return this.isFrequency(e)?parseFloat(e):this.isNotation(e)||this.isTransportTime(e)?this.secondsToFrequency(this.toSeconds(e,t)):this.isNote(e)?this.noteToFrequency(e):e},Tone.prototype.toTicks=function(e){if(this.isUndef(Tone.Transport))return 0;var t=Tone.Transport.bpm.value,i=0;if(this.isNowRelative(e))e=e.replace("+",""),i=Tone.Transport.ticks;else if(this.isUndef(e))return Tone.Transport.ticks;var n=this.toSeconds(e),r=60/t,o=n/r,a=o*Tone.Transport.PPQ;return Math.round(a+i)},Tone.prototype.toSamples=function(e){var t=this.toSeconds(e);return Math.round(t*this.context.sampleRate)},Tone.prototype.toSeconds=function(time,now){if(now=this.defaultArg(now,this.now()),this.isNumber(time))return time;if(this.isString(time)){var plusTime=0;this.isNowRelative(time)&&(time=time.replace("+",""),plusTime=now);var betweenParens=time.match(/\(([^)(]+)\)/g);if(betweenParens)for(var j=0;j<betweenParens.length;j++){var symbol=betweenParens[j].replace(/[\(\)]/g,""),symbolVal=this.toSeconds(symbol);time=time.replace(betweenParens[j],symbolVal)}if(-1!==time.indexOf("@")){var quantizationSplit=time.split("@");if(this.isUndef(Tone.Transport))throw new Error("quantization requires Tone.Transport");var toQuantize=quantizationSplit[0].trim();""===toQuantize&&(toQuantize=void 0),plusTime>0&&(toQuantize="+"+toQuantize,plusTime=0);var subdivision=quantizationSplit[1].trim();time=Tone.Transport.quantize(toQuantize,subdivision)}else{var components=time.split(/[\(\)\-\+\/\*]/);if(components.length>1){for(var originalTime=time,i=0;i<components.length;i++){var symb=components[i].trim();if(""!==symb){var val=this.toSeconds(symb);time=time.replace(symb,val)}}try{time=eval(time)}catch(e){throw new EvalError("cannot evaluate Time: "+originalTime)}}else time=this.isNotation(time)?this.notationToSeconds(time):this.isTransportTime(time)?this.transportTimeToSeconds(time):this.isFrequency(time)?this.frequencyToSeconds(time):this.isTicks(time)?this.ticksToSeconds(time):parseFloat(time)}return time+plusTime}return now},Tone.prototype.toNotation=function(e,t,i){var n=["1m","2n","4n","8n","16n","32n","64n","128n"],r=toNotationHelper.call(this,e,t,i,n),o=["1m","2n","2t","4n","4t","8n","8t","16n","16t","32n","32t","64n","64t","128n"],a=toNotationHelper.call(this,e,t,i,o);return a.split("+").length<r.split("+").length?a:r},Tone.prototype.fromUnits=function(e,t){if(!this.convert&&!this.isUndef(this.convert))return e;switch(t){case Tone.Type.Time:return this.toSeconds(e);case Tone.Type.Frequency:return this.toFrequency(e);case Tone.Type.Decibels:return this.dbToGain(e);case Tone.Type.NormalRange:return Math.min(Math.max(e,0),1);case Tone.Type.AudioRange:return Math.min(Math.max(e,-1),1);case Tone.Type.Positive:return Math.max(e,0);default:return e}},Tone.prototype.toUnits=function(e,t){if(!this.convert&&!this.isUndef(this.convert))return e;switch(t){case Tone.Type.Decibels:return this.gainToDb(e);default:return e}};var noteToScaleIndex={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},scaleIndexToNote=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return Tone.A4=440,Tone.prototype.noteToFrequency=function(e){var t=e.split(/(-?\d+)/);if(3===t.length){var i=noteToScaleIndex[t[0].toLowerCase()],n=t[1],r=i+12*(parseInt(n,10)+1);return this.midiToFrequency(r)}return 0},Tone.prototype.frequencyToNote=function(e){var t=Math.log(e/Tone.A4)/Math.LN2,i=Math.round(12*t)+57,n=Math.floor(i/12);0>n&&(i+=-12*n);var r=scaleIndexToNote[i%12];return r+n.toString()},Tone.prototype.intervalToFrequencyRatio=function(e){return Math.pow(2,e/12)},Tone.prototype.midiToNote=function(e){var t=Math.floor(e/12)-1,i=e%12;return scaleIndexToNote[i]+t},Tone.prototype.noteToMidi=function(e){var t=e.split(/(\d+)/);if(3===t.length){var i=noteToScaleIndex[t[0].toLowerCase()],n=t[1];return i+12*(parseInt(n,10)+1)}return 0},Tone.prototype.midiToFrequency=function(e){return Tone.A4*Math.pow(2,(e-69)/12)},Tone}(Tone_core_Tone);var Tone_core_Param;Tone_core_Param=function(e){"use strict";return e.Param=function(){var t=this.optionsObject(arguments,["param","units","convert"],e.Param.defaults);this._param=this.input=t.param,this.units=t.units,this.convert=t.convert,this.overridden=!1,this.isUndef(t.value)||(this.value=t.value)},e.extend(e.Param),e.Param.defaults={units:e.Type.Default,convert:!0,param:void 0},Object.defineProperty(e.Param.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(e){var t=this._fromUnits(e);this._param.value=t}}),e.Param.prototype._fromUnits=function(t){if(!this.convert&&!this.isUndef(this.convert))return t;switch(this.units){case e.Type.Time:return this.toSeconds(t);case e.Type.Frequency:return this.toFrequency(t);case e.Type.Decibels:return this.dbToGain(t);case e.Type.NormalRange:return Math.min(Math.max(t,0),1);case e.Type.AudioRange:return Math.min(Math.max(t,-1),1);case e.Type.Positive:return Math.max(t,0);default:return t}},e.Param.prototype._toUnits=function(t){if(!this.convert&&!this.isUndef(this.convert))return t;switch(this.units){case e.Type.Decibels:return this.gainToDb(t);default:return t}},e.Param.prototype._minOutput=1e-5,e.Param.prototype.setValueAtTime=function(e,t){return e=this._fromUnits(e),this._param.setValueAtTime(e,this.toSeconds(t)),this},e.Param.prototype.setRampPoint=function(e){e=this.defaultArg(e,this.now());var t=this._param.value;return this._param.setValueAtTime(t,e),this},e.Param.prototype.linearRampToValueAtTime=function(e,t){return e=this._fromUnits(e),this._param.linearRampToValueAtTime(e,this.toSeconds(t)),this},e.Param.prototype.exponentialRampToValueAtTime=function(e,t){return e=this._fromUnits(e),e=Math.max(this._minOutput,e),this._param.exponentialRampToValueAtTime(e,this.toSeconds(t)),this},e.Param.prototype.exponentialRampToValue=function(e,t){var i=this.now(),n=this.value;return this.setValueAtTime(Math.max(n,this._minOutput),i),this.exponentialRampToValueAtTime(e,i+this.toSeconds(t)),this},e.Param.prototype.linearRampToValue=function(e,t){var i=this.now();return this.setRampPoint(i),this.linearRampToValueAtTime(e,i+this.toSeconds(t)),this},e.Param.prototype.setTargetAtTime=function(e,t,i){return e=this._fromUnits(e),e=Math.max(this._minOutput,e),i=Math.max(this._minOutput,i),this._param.setTargetAtTime(e,this.toSeconds(t),i),this},e.Param.prototype.setValueCurveAtTime=function(e,t,i){for(var n=0;n<e.length;n++)e[n]=this._fromUnits(e[n]);return this._param.setValueCurveAtTime(e,this.toSeconds(t),this.toSeconds(i)),this},e.Param.prototype.cancelScheduledValues=function(e){return this._param.cancelScheduledValues(this.toSeconds(e)),this},e.Param.prototype.rampTo=function(t,i){return i=this.defaultArg(i,0),this.units===e.Type.Frequency||this.units===e.Type.BPM?this.exponentialRampToValue(t,i):this.linearRampToValue(t,i),this},e.Param.prototype.dispose=function(){return e.prototype.dispose.call(this),this._param=null,this},e.Param}(Tone_core_Tone);var Tone_core_Gain;Tone_core_Gain=function(e){"use strict";return e.Gain=function(){var t=this.optionsObject(arguments,["gain","units"],e.Gain.defaults);this.input=this.output=this._gainNode=this.context.createGain(),this.gain=new e.Param({param:this._gainNode.gain,units:t.units,value:t.gain,convert:t.convert}),this._readOnly("gain")},e.extend(e.Gain),e.Gain.defaults={gain:1,convert:!0},e.Gain.prototype.dispose=function(){e.Param.prototype.dispose.call(this),this._gainNode.disconnect(),this._gainNode=null,this._writable("gain"),this.gain.dispose(),this.gain=null},e.Gain}(Tone_core_Tone,Tone_core_Param);var Tone_signal_Signal;Tone_signal_Signal=function(e){"use strict";return e.Signal=function(){var t=this.optionsObject(arguments,["value","units"],e.Signal.defaults);this.output=this._gain=this.context.createGain(),t.param=this._gain.gain,e.Param.call(this,t),this.input=this._param=this._gain.gain,e.Signal._constant.chain(this._gain)},e.extend(e.Signal,e.Param),e.Signal.defaults={value:0,units:e.Type.Default,convert:!0},e.Signal.prototype.connect=e.SignalBase.prototype.connect,e.Signal.prototype.dispose=function(){return e.Param.prototype.dispose.call(this),this._param=null,this._gain.disconnect(),this._gain=null,this},e.Signal._constant=null,e._initAudioContext(function(t){for(var i=t.createBuffer(1,128,t.sampleRate),n=i.getChannelData(0),r=0;r<n.length;r++)n[r]=1;e.Signal._constant=t.createBufferSource(),e.Signal._constant.channelCount=1,e.Signal._constant.channelCountMode="explicit",e.Signal._constant.buffer=i,e.Signal._constant.loop=!0,e.Signal._constant.start(0),e.Signal._constant.noGC()}),e.Signal}(Tone_core_Tone,Tone_signal_WaveShaper,Tone_core_Type,Tone_core_Param);var Tone_signal_Add;Tone_signal_Add=function(e){"use strict";return e.Add=function(t){e.call(this,2,0),this._sum=this.input[0]=this.input[1]=this.output=this.context.createGain(),this._param=this.input[1]=new e.Signal(t),this._param.connect(this._sum)},e.extend(e.Add,e.Signal),e.Add.prototype.dispose=function(){return e.prototype.dispose.call(this),this._sum.disconnect(),this._sum=null,this._param.dispose(),this._param=null,this},e.Add}(Tone_core_Tone);var Tone_signal_Multiply;Tone_signal_Multiply=function(e){"use strict";return e.Multiply=function(t){e.call(this,2,0),this._mult=this.input[0]=this.output=this.context.createGain(),this._param=this.input[1]=this.output.gain,this._param.value=this.defaultArg(t,0)},e.extend(e.Multiply,e.Signal),e.Multiply.prototype.dispose=function(){return e.prototype.dispose.call(this),this._mult.disconnect(),this._mult=null,this._param=null,this},e.Multiply}(Tone_core_Tone);var Tone_signal_Scale;Tone_signal_Scale=function(e){"use strict";return e.Scale=function(t,i){this._outputMin=this.defaultArg(t,0),this._outputMax=this.defaultArg(i,1),this._scale=this.input=new e.Multiply(1),this._add=this.output=new e.Add(0),this._scale.connect(this._add),this._setRange()},e.extend(e.Scale,e.SignalBase),Object.defineProperty(e.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(e){this._outputMin=e,this._setRange()}}),Object.defineProperty(e.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(e){this._outputMax=e,this._setRange()}}),e.Scale.prototype._setRange=function(){this._add.value=this._outputMin,this._scale.value=this._outputMax-this._outputMin},e.Scale.prototype.dispose=function(){return e.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},e.Scale}(Tone_core_Tone,Tone_signal_Add,Tone_signal_Multiply);var signal;signal=function(){"use strict";var e=Tone_signal_Signal,t=Tone_signal_Add,i=Tone_signal_Multiply,n=Tone_signal_Scale,r=Tone_core_Tone,o=master;r.setContext(o.audiocontext),p5.Signal=function(t){var i=new e(t);return i},e.prototype.fade=e.prototype.linearRampToValueAtTime,i.prototype.fade=e.prototype.fade,t.prototype.fade=e.prototype.fade,n.prototype.fade=e.prototype.fade,e.prototype.setInput=function(e){e.connect(this)},i.prototype.setInput=e.prototype.setInput,t.prototype.setInput=e.prototype.setInput,n.prototype.setInput=e.prototype.setInput,e.prototype.add=function(e){var i=new t(e);return this.connect(i),i},i.prototype.add=e.prototype.add,t.prototype.add=e.prototype.add,n.prototype.add=e.prototype.add,e.prototype.mult=function(e){var t=new i(e);return this.connect(t),t},i.prototype.mult=e.prototype.mult,t.prototype.mult=e.prototype.mult,n.prototype.mult=e.prototype.mult,e.prototype.scale=function(e,t,i,r){var o,a;4===arguments.length?(o=p5.prototype.map(i,e,t,0,1)-.5,a=p5.prototype.map(r,e,t,0,1)-.5):(o=arguments[0],a=arguments[1]);var s=new n(o,a);return this.connect(s),s},i.prototype.scale=e.prototype.scale,t.prototype.scale=e.prototype.scale,n.prototype.scale=e.prototype.scale}(Tone_signal_Signal,Tone_signal_Add,Tone_signal_Multiply,Tone_signal_Scale,Tone_core_Tone,master);var oscillator;oscillator=function(){"use strict";var e=master,i=Tone_signal_Add,n=Tone_signal_Multiply,r=Tone_signal_Scale;p5.Oscillator=function(t,i){if("string"==typeof t){var n=i;i=t,t=n}if("number"==typeof i){var n=i;i=t,t=n}this.started=!1,this.phaseAmount=void 0,this.oscillator=e.audiocontext.createOscillator(),this.f=t||440,this.oscillator.type=i||"sine",this.oscillator.frequency.setValueAtTime(this.f,e.audiocontext.currentTime);this.oscillator;this.output=e.audiocontext.createGain(),this._freqMods=[],this.output.gain.value=.5,this.output.gain.setValueAtTime(.5,e.audiocontext.currentTime),this.oscillator.connect(this.output),this.panPosition=0,this.connection=e.input,this.panner=new p5.Panner(this.output,this.connection,1),this.mathOps=[this.output],e.soundArray.push(this)},p5.Oscillator.prototype.start=function(t,i){if(this.started){var n=e.audiocontext.currentTime;this.stop(n)}if(!this.started){var r=i||this.f,o=this.oscillator.type;this.oscillator&&(this.oscillator.disconnect(),this.oscillator=void 0),this.oscillator=e.audiocontext.createOscillator(),this.oscillator.frequency.exponentialRampToValueAtTime(Math.abs(r),e.audiocontext.currentTime),this.oscillator.type=o,this.oscillator.connect(this.output),t=t||0,this.oscillator.start(t+e.audiocontext.currentTime),this.freqNode=this.oscillator.frequency;for(var a in this._freqMods)"undefined"!=typeof this._freqMods[a].connect&&this._freqMods[a].connect(this.oscillator.frequency);this.started=!0}},p5.Oscillator.prototype.stop=function(t){if(this.started){var i=t||0,n=e.audiocontext.currentTime;this.oscillator.stop(i+n),this.started=!1}},p5.Oscillator.prototype.amp=function(t,i,n){var r=this;if("number"==typeof t){var i=i||0,n=n||0,o=e.audiocontext.currentTime,a=this.output.gain.value;this.output.gain.cancelScheduledValues(o),this.output.gain.linearRampToValueAtTime(a,o+n),this.output.gain.linearRampToValueAtTime(t,o+n+i)}else{if(!t)return this.output.gain;t.connect(r.output.gain)}},p5.Oscillator.prototype.fade=p5.Oscillator.prototype.amp,p5.Oscillator.prototype.getAmp=function(){return this.output.gain.value},p5.Oscillator.prototype.freq=function(t,i,n){if("number"!=typeof t||isNaN(t)){if(!t)return this.oscillator.frequency;t.output&&(t=t.output),t.connect(this.oscillator.frequency),this._freqMods.push(t)}else{this.f=t;var r=e.audiocontext.currentTime,i=i||0,n=n||0;0==i?(this.oscillator.frequency.cancelScheduledValues(r),this.oscillator.frequency.setValueAtTime(t,n+r)):t>0?this.oscillator.frequency.exponentialRampToValueAtTime(t,n+i+r):this.oscillator.frequency.linearRampToValueAtTime(t,n+i+r),this.phaseAmount&&this.phase(this.phaseAmount)}},p5.Oscillator.prototype.getFreq=function(){return this.oscillator.frequency.value},p5.Oscillator.prototype.setType=function(e){this.oscillator.type=e},p5.Oscillator.prototype.getType=function(){return this.oscillator.type},p5.Oscillator.prototype.connect=function(t){t?t.hasOwnProperty("input")?(this.panner.connect(t.input),this.connection=t.input):(this.panner.connect(t),this.connection=t):this.panner.connect(e.input)},p5.Oscillator.prototype.disconnect=function(e){this.output.disconnect(),this.panner.disconnect(),this.output.connect(this.panner),this.oscMods=[]},p5.Oscillator.prototype.pan=function(e,t){this.panPosition=e,this.panner.pan(e,t)},p5.Oscillator.prototype.getPan=function(){return this.panPosition},p5.Oscillator.prototype.dispose=function(){var t=e.soundArray.indexOf(this);if(e.soundArray.splice(t,1),this.oscillator){var i=e.audiocontext.currentTime;this.stop(i),this.disconnect(),this.panner=null,this.oscillator=null}this.osc2&&this.osc2.dispose()},p5.Oscillator.prototype.phase=function(t){var i=p5.prototype.map(t,0,1,0,1/this.f),n=e.audiocontext.currentTime;this.phaseAmount=t,this.dNode||(this.dNode=e.audiocontext.createDelay(),this.oscillator.disconnect(),this.oscillator.connect(this.dNode),this.dNode.connect(this.output)),this.dNode.delayTime.setValueAtTime(i,n)};var o=function(e,t,i,n,r){var o=e.oscillator;for(var a in e.mathOps)e.mathOps[a]instanceof r&&(o.disconnect(),e.mathOps[a].dispose(),i=a,i<e.mathOps.length-2&&(n=e.mathOps[a+1]));return i==e.mathOps.length-1&&e.mathOps.push(n),a>0&&(o=e.mathOps[a-1]),o.disconnect(),o.connect(t),t.connect(n),e.mathOps[i]=t,e};p5.Oscillator.prototype.add=function(e){var t=new i(e),n=this.mathOps.length-1,r=this.output;return o(this,t,n,r,i)},p5.Oscillator.prototype.mult=function(e){var t=new n(e),i=this.mathOps.length-1,r=this.output;return o(this,t,i,r,n)},p5.Oscillator.prototype.scale=function(e,t,i,n){var a,s;4===arguments.length?(a=p5.prototype.map(i,e,t,0,1)-.5,s=p5.prototype.map(n,e,t,0,1)-.5):(a=arguments[0],s=arguments[1]);var l=new r(a,s),u=this.mathOps.length-1,h=this.output;return o(this,l,u,h,r)},p5.SinOsc=function(e){p5.Oscillator.call(this,e,"sine")},p5.SinOsc.prototype=Object.create(p5.Oscillator.prototype),p5.TriOsc=function(e){p5.Oscillator.call(this,e,"triangle")},p5.TriOsc.prototype=Object.create(p5.Oscillator.prototype),p5.SawOsc=function(e){p5.Oscillator.call(this,e,"sawtooth")},p5.SawOsc.prototype=Object.create(p5.Oscillator.prototype),p5.SqrOsc=function(e){p5.Oscillator.call(this,e,"square")},p5.SqrOsc.prototype=Object.create(p5.Oscillator.prototype)}(master,Tone_signal_Signal,Tone_signal_Add,Tone_signal_Multiply,Tone_signal_Scale);var Tone_core_Timeline;Tone_core_Timeline=function(e){"use strict";return e.Timeline=function(){var t=this.optionsObject(arguments,["memory"],e.Timeline.defaults);this._timeline=[],this._toRemove=[],this._iterating=!1,this.memory=t.memory},e.extend(e.Timeline),e.Timeline.defaults={memory:1/0},Object.defineProperty(e.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),e.Timeline.prototype.addEvent=function(e){if(this.isUndef(e.time))throw new Error("events must have a time attribute");if(e.time=this.toSeconds(e.time),this._timeline.length){var t=this._search(e.time);this._timeline.splice(t+1,0,e)}else this._timeline.push(e);if(this.length>this.memory){var i=this.length-this.memory;this._timeline.splice(0,i)}return this},e.Timeline.prototype.removeEvent=function(e){if(this._iterating)this._toRemove.push(e);else{var t=this._timeline.indexOf(e);-1!==t&&this._timeline.splice(t,1)}return this},e.Timeline.prototype.getEvent=function(e){e=this.toSeconds(e);var t=this._search(e);return-1!==t?this._timeline[t]:null},e.Timeline.prototype.getEventAfter=function(e){e=this.toSeconds(e);var t=this._search(e);return t+1<this._timeline.length?this._timeline[t+1]:null},e.Timeline.prototype.getEventBefore=function(e){e=this.toSeconds(e);var t=this._search(e);return t-1>=0?this._timeline[t-1]:null},e.Timeline.prototype.cancel=function(e){if(this._timeline.length>1){e=this.toSeconds(e);var t=this._search(e);t>=0?this._timeline=this._timeline.slice(0,t):this._timeline=[]}else 1===this._timeline.length&&this._timeline[0].time>=e&&(this._timeline=[]);return this},e.Timeline.prototype.cancelBefore=function(e){if(this._timeline.length){e=this.toSeconds(e);var t=this._search(e);t>=0&&(this._timeline=this._timeline.slice(t+1))}return this},e.Timeline.prototype._search=function(e){for(var t=0,i=this._timeline.length,n=i;n>=t&&i>t;){var r=Math.floor(t+(n-t)/2),o=this._timeline[r];if(o.time===e){for(var a=r;a<this._timeline.length;a++){var s=this._timeline[a];s.time===e&&(r=a)}return r}o.time>e?n=r-1:o.time<e&&(t=r+1)}return t-1},e.Timeline.prototype._iterate=function(e,t,i){this._iterating=!0,t=this.defaultArg(t,0),i=this.defaultArg(i,this._timeline.length-1);for(var n=t;i>=n;n++)e(this._timeline[n]);if(this._iterating=!1,this._toRemove.length>0){for(var r=0;r<this._toRemove.length;r++){var o=this._timeline.indexOf(this._toRemove[r]);-1!==o&&this._timeline.splice(o,1)}this._toRemove=[]}},e.Timeline.prototype.forEach=function(e){return this._iterate(e),this},e.Timeline.prototype.forEachBefore=function(e,t){e=this.toSeconds(e);var i=this._search(e);return-1!==i&&this._iterate(t,0,i),this},e.Timeline.prototype.forEachAfter=function(e,t){e=this.toSeconds(e);var i=this._search(e);return this._iterate(t,i+1),this},e.Timeline.prototype.forEachFrom=function(e,t){e=this.toSeconds(e);for(var i=this._search(e);i>=0&&this._timeline[i].time>=e;)i--;return this._iterate(t,i+1),this},e.Timeline.prototype.forEachAtTime=function(e,t){e=this.toSeconds(e);var i=this._search(e);return-1!==i&&this._iterate(function(i){i.time===e&&t(i)},0,i),this},e.Timeline.prototype.dispose=function(){e.prototype.dispose.call(this),this._timeline=null,this._toRemove=null},e.Timeline}(Tone_core_Tone);var Tone_signal_TimelineSignal;Tone_signal_TimelineSignal=function(e){"use strict";return e.TimelineSignal=function(){var t=this.optionsObject(arguments,["value","units"],e.Signal.defaults);e.Signal.apply(this,t),t.param=this._param,e.Param.call(this,t),this._events=new e.Timeline(10),this._initial=this._fromUnits(this._param.value)},e.extend(e.TimelineSignal,e.Param),e.TimelineSignal.Type={Linear:"linear",Exponential:"exponential",Target:"target",Set:"set"},Object.defineProperty(e.TimelineSignal.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(e){var t=this._fromUnits(e);this._initial=t,this._param.value=t}}),e.TimelineSignal.prototype.setValueAtTime=function(t,i){return t=this._fromUnits(t),i=this.toSeconds(i),this._events.addEvent({type:e.TimelineSignal.Type.Set,value:t,time:i}),this._param.setValueAtTime(t,i),this},e.TimelineSignal.prototype.linearRampToValueAtTime=function(t,i){return t=this._fromUnits(t),
i=this.toSeconds(i),this._events.addEvent({type:e.TimelineSignal.Type.Linear,value:t,time:i}),this._param.linearRampToValueAtTime(t,i),this},e.TimelineSignal.prototype.exponentialRampToValueAtTime=function(t,i){return t=this._fromUnits(t),t=Math.max(this._minOutput,t),i=this.toSeconds(i),this._events.addEvent({type:e.TimelineSignal.Type.Exponential,value:t,time:i}),this._param.exponentialRampToValueAtTime(t,i),this},e.TimelineSignal.prototype.setTargetAtTime=function(t,i,n){return t=this._fromUnits(t),t=Math.max(this._minOutput,t),n=Math.max(this._minOutput,n),i=this.toSeconds(i),this._events.addEvent({type:e.TimelineSignal.Type.Target,value:t,time:i,constant:n}),this._param.setTargetAtTime(t,i,n),this},e.TimelineSignal.prototype.cancelScheduledValues=function(e){return this._events.cancel(e),this._param.cancelScheduledValues(this.toSeconds(e)),this},e.TimelineSignal.prototype.setRampPoint=function(t){t=this.toSeconds(t);var i=this.getValueAtTime(t),n=this._searchAfter(t);return n&&(this.cancelScheduledValues(t),n.type===e.TimelineSignal.Type.Linear?this.linearRampToValueAtTime(i,t):n.type===e.TimelineSignal.Type.Exponential&&this.exponentialRampToValueAtTime(i,t)),this.setValueAtTime(i,t),this},e.TimelineSignal.prototype.linearRampToValueBetween=function(e,t,i){return this.setRampPoint(t),this.linearRampToValueAtTime(e,i),this},e.TimelineSignal.prototype.exponentialRampToValueBetween=function(e,t,i){return this.setRampPoint(t),this.exponentialRampToValueAtTime(e,i),this},e.TimelineSignal.prototype._searchBefore=function(e){return this._events.getEvent(e)},e.TimelineSignal.prototype._searchAfter=function(e){return this._events.getEventAfter(e)},e.TimelineSignal.prototype.getValueAtTime=function(t){var i=this._searchAfter(t),n=this._searchBefore(t),r=this._initial;if(null===n)r=this._initial;else if(n.type===e.TimelineSignal.Type.Target){var a,o=this._events.getEventBefore(n.time);a=null===o?this._initial:o.value,r=this._exponentialApproach(n.time,a,n.value,n.constant,t)}else r=null===i?n.value:i.type===e.TimelineSignal.Type.Linear?this._linearInterpolate(n.time,n.value,i.time,i.value,t):i.type===e.TimelineSignal.Type.Exponential?this._exponentialInterpolate(n.time,n.value,i.time,i.value,t):n.value;return r},e.TimelineSignal.prototype.connect=e.SignalBase.prototype.connect,e.TimelineSignal.prototype._exponentialApproach=function(e,t,i,n,r){return i+(t-i)*Math.exp(-(r-e)/n)},e.TimelineSignal.prototype._linearInterpolate=function(e,t,i,n,r){return t+(n-t)*((r-e)/(i-e))},e.TimelineSignal.prototype._exponentialInterpolate=function(e,t,i,n,r){return t=Math.max(this._minOutput,t),t*Math.pow(n/t,(r-e)/(i-e))},e.TimelineSignal.prototype.dispose=function(){e.Signal.prototype.dispose.call(this),e.Param.prototype.dispose.call(this),this._events.dispose(),this._events=null},e.TimelineSignal}(Tone_core_Tone,Tone_signal_Signal);var env;env=function(){"use strict";var e=master,t=Tone_signal_Add,i=Tone_signal_Multiply,n=Tone_signal_Scale,r=Tone_signal_TimelineSignal,o=Tone_core_Tone;o.setContext(e.audiocontext),p5.Env=function(t,i,n,o,a,s){e.audiocontext.currentTime;this.aTime=t||.1,this.aLevel=i||1,this.dTime=n||.5,this.dLevel=o||0,this.rTime=a||0,this.rLevel=s||0,this._rampHighPercentage=.98,this._rampLowPercentage=.02,this.output=e.audiocontext.createGain(),this.control=new r,this._init(),this.control.connect(this.output),this.connection=null,this.mathOps=[this.control],this.isExponential=!1,this.sourceToClear=null,this.wasTriggered=!1,e.soundArray.push(this)},p5.Env.prototype._init=function(){var t=e.audiocontext.currentTime,i=t;this.control.setTargetAtTime(1e-5,i,.001),this._setRampAD(this.aTime,this.dTime)},p5.Env.prototype.set=function(e,t,i,n,r,o){this.aTime=e,this.aLevel=t,this.dTime=i||0,this.dLevel=n||0,this.rTime=r||0,this.rLevel=o||0,this._setRampAD(e,i)},p5.Env.prototype.setADSR=function(e,t,i,n){this.aTime=e,this.dTime=t||0,this.sPercent=i||0,this.dLevel="undefined"!=typeof i?i*(this.aLevel-this.rLevel)+this.rLevel:0,this.rTime=n||0,this._setRampAD(e,t)},p5.Env.prototype.setRange=function(e,t){this.aLevel=e||1,this.rLevel=t||0},p5.Env.prototype._setRampAD=function(e,t){this._rampAttackTime=this.checkExpInput(e),this._rampDecayTime=this.checkExpInput(t);var i=1;i=Math.log(1/this.checkExpInput(1-this._rampHighPercentage)),this._rampAttackTC=e/this.checkExpInput(i),i=Math.log(1/this._rampLowPercentage),this._rampDecayTC=t/this.checkExpInput(i)},p5.Env.prototype.setRampPercentages=function(e,t){this._rampHighPercentage=this.checkExpInput(e),this._rampLowPercentage=this.checkExpInput(t);var i=1;i=Math.log(1/this.checkExpInput(1-this._rampHighPercentage)),this._rampAttackTC=this._rampAttackTime/this.checkExpInput(i),i=Math.log(1/this._rampLowPercentage),this._rampDecayTC=this._rampDecayTime/this.checkExpInput(i)},p5.Env.prototype.setInput=function(e){for(var t=0;t<arguments.length;t++)this.connect(arguments[t])},p5.Env.prototype.setExp=function(e){this.isExponential=e},p5.Env.prototype.checkExpInput=function(e){return 0>=e&&(e=1e-8),e},p5.Env.prototype.play=function(t,i,n){var o=(e.audiocontext.currentTime,i||0),n=n||0;t&&this.connection!==t&&this.connect(t),this.triggerAttack(t,o),this.triggerRelease(t,o+this.aTime+this.dTime+n)},p5.Env.prototype.triggerAttack=function(t,i){var n=e.audiocontext.currentTime,r=i||0,o=n+r;this.lastAttack=o,this.wasTriggered=!0,t&&this.connection!==t&&this.connect(t);var a=this.control.getValueAtTime(o);this.control.cancelScheduledValues(o),1==this.isExponential?this.control.exponentialRampToValueAtTime(this.checkExpInput(a),o):this.control.linearRampToValueAtTime(a,o),o+=this.aTime,1==this.isExponential?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.aLevel),o),a=this.checkExpInput(this.control.getValueAtTime(o)),this.control.cancelScheduledValues(o),this.control.exponentialRampToValueAtTime(a,o)):(this.control.linearRampToValueAtTime(this.aLevel,o),a=this.control.getValueAtTime(o),this.control.cancelScheduledValues(o),this.control.linearRampToValueAtTime(a,o)),o+=this.dTime,1==this.isExponential?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.dLevel),o),a=this.checkExpInput(this.control.getValueAtTime(o)),this.control.cancelScheduledValues(o),this.control.exponentialRampToValueAtTime(a,o)):(this.control.linearRampToValueAtTime(this.dLevel,o),a=this.control.getValueAtTime(o),this.control.cancelScheduledValues(o),this.control.linearRampToValueAtTime(a,o))},p5.Env.prototype.triggerRelease=function(t,i){if(this.wasTriggered){var n=e.audiocontext.currentTime,r=i||0,o=n+r;t&&this.connection!==t&&this.connect(t);var a=this.control.getValueAtTime(o);this.control.cancelScheduledValues(o),1==this.isExponential?this.control.exponentialRampToValueAtTime(this.checkExpInput(a),o):this.control.linearRampToValueAtTime(a,o),o+=this.rTime,1==this.isExponential?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.rLevel),o),a=this.checkExpInput(this.control.getValueAtTime(o)),this.control.cancelScheduledValues(o),this.control.exponentialRampToValueAtTime(a,o)):(this.control.linearRampToValueAtTime(this.rLevel,o),a=this.control.getValueAtTime(o),this.control.cancelScheduledValues(o),this.control.linearRampToValueAtTime(a,o)),this.wasTriggered=!1}},p5.Env.prototype.ramp=function(t,i,n,r){var o=e.audiocontext.currentTime,a=i||0,s=o+a,l=this.checkExpInput(n),u="undefined"!=typeof r?this.checkExpInput(r):void 0;t&&this.connection!==t&&this.connect(t);var h=this.checkExpInput(this.control.getValueAtTime(s));this.control.cancelScheduledValues(s),l>h?(this.control.setTargetAtTime(l,s,this._rampAttackTC),s+=this._rampAttackTime):h>l&&(this.control.setTargetAtTime(l,s,this._rampDecayTC),s+=this._rampDecayTime),void 0!==u&&(u>l?this.control.setTargetAtTime(u,s,this._rampAttackTC):l>u&&this.control.setTargetAtTime(u,s,this._rampDecayTC))},p5.Env.prototype.connect=function(t){this.connection=t,(t instanceof p5.Oscillator||t instanceof p5.SoundFile||t instanceof p5.AudioIn||t instanceof p5.Reverb||t instanceof p5.Noise||t instanceof p5.Filter||t instanceof p5.Delay)&&(t=t.output.gain),t instanceof AudioParam&&t.setValueAtTime(0,e.audiocontext.currentTime),t instanceof p5.Signal&&t.setValue(0),this.output.connect(t)},p5.Env.prototype.disconnect=function(e){this.output.disconnect()},p5.Env.prototype.add=function(e){var i=new t(e),n=this.mathOps.length,r=this.output;return p5.prototype._mathChain(this,i,n,r,t)},p5.Env.prototype.mult=function(e){var t=new i(e),n=this.mathOps.length,r=this.output;return p5.prototype._mathChain(this,t,n,r,i)},p5.Env.prototype.scale=function(e,t,i,r){var o=new n(e,t,i,r),a=this.mathOps.length,s=this.output;return p5.prototype._mathChain(this,o,a,s,n)},p5.Env.prototype.dispose=function(){var t=e.soundArray.indexOf(this);e.soundArray.splice(t,1);e.audiocontext.currentTime;this.disconnect();try{this.control.dispose(),this.control=null}catch(n){}for(var r=1;r<this.mathOps.length;r++)mathOps[r].dispose()}}(master,Tone_signal_Add,Tone_signal_Multiply,Tone_signal_Scale,Tone_signal_TimelineSignal,Tone_core_Tone);var pulse;pulse=function(){"use strict";function t(){for(var t=e.audiocontext,i=t.createBuffer(1,2048,t.sampleRate),n=i.getChannelData(0),r=0;2048>r;r++)n[r]=1;var o=t.createBufferSource();return o.buffer=i,o.loop=!0,o}var e=master;p5.Pulse=function(i,n){p5.Oscillator.call(this,i,"sawtooth"),this.w=n||0,this.osc2=new p5.SawOsc(i),this.dNode=e.audiocontext.createDelay(),this.dcOffset=t(),this.dcGain=e.audiocontext.createGain(),this.dcOffset.connect(this.dcGain),this.dcGain.connect(this.output),this.f=i||440;var r=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=r,this.dcGain.gain.value=1.7*(.5-this.w),this.osc2.disconnect(),this.osc2.panner.disconnect(),this.osc2.amp(-1),this.osc2.output.connect(this.dNode),this.dNode.connect(this.output),this.output.gain.value=1,this.output.connect(this.panner)},p5.Pulse.prototype=Object.create(p5.Oscillator.prototype),p5.Pulse.prototype.width=function(e){if("number"==typeof e){if(1>=e&&e>=0){this.w=e;var t=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=t}this.dcGain.gain.value=1.7*(.5-this.w)}else{e.connect(this.dNode.delayTime);var i=new p5.SignalAdd(-.5);i.setInput(e),i=i.mult(-1),i=i.mult(1.7),i.connect(this.dcGain.gain)}},p5.Pulse.prototype.start=function(i,n){var r=e.audiocontext.currentTime,o=n||0;if(!this.started){var a=i||this.f,s=this.oscillator.type;this.oscillator=e.audiocontext.createOscillator(),this.oscillator.frequency.setValueAtTime(a,r),this.oscillator.type=s,this.oscillator.connect(this.output),this.oscillator.start(o+r),this.osc2.oscillator=e.audiocontext.createOscillator(),this.osc2.oscillator.frequency.setValueAtTime(a,o+r),this.osc2.oscillator.type=s,this.osc2.oscillator.connect(this.osc2.output),this.osc2.start(o+r),this.freqNode=[this.oscillator.frequency,this.osc2.oscillator.frequency],this.dcOffset=t(),this.dcOffset.connect(this.dcGain),this.dcOffset.start(o+r),void 0!==this.mods&&void 0!==this.mods.frequency&&(this.mods.frequency.connect(this.freqNode[0]),this.mods.frequency.connect(this.freqNode[1])),this.started=!0,this.osc2.started=!0}},p5.Pulse.prototype.stop=function(t){if(this.started){var i=t||0,n=e.audiocontext.currentTime;this.oscillator.stop(i+n),this.osc2.oscillator.stop(i+n),this.dcOffset.stop(i+n),this.started=!1,this.osc2.started=!1}},p5.Pulse.prototype.freq=function(t,i,n){if("number"==typeof t){this.f=t;var r=e.audiocontext.currentTime,i=i||0,n=n||0,o=this.oscillator.frequency.value;this.oscillator.frequency.cancelScheduledValues(r),this.oscillator.frequency.setValueAtTime(o,r+n),this.oscillator.frequency.exponentialRampToValueAtTime(t,n+i+r),this.osc2.oscillator.frequency.cancelScheduledValues(r),this.osc2.oscillator.frequency.setValueAtTime(o,r+n),this.osc2.oscillator.frequency.exponentialRampToValueAtTime(t,n+i+r),this.freqMod&&(this.freqMod.output.disconnect(),this.freqMod=null)}else t.output&&(t.output.disconnect(),t.output.connect(this.oscillator.frequency),t.output.connect(this.osc2.oscillator.frequency),this.freqMod=t)}}(master,oscillator);var noise;noise=function(){"use strict";var e=master;p5.Noise=function(e){var r;p5.Oscillator.call(this),delete this.f,delete this.freq,delete this.oscillator,r="brown"===e?n:"pink"===e?i:t,this.buffer=r},p5.Noise.prototype=Object.create(p5.Oscillator.prototype);var t=function(){for(var t=2*e.audiocontext.sampleRate,i=e.audiocontext.createBuffer(1,t,e.audiocontext.sampleRate),n=i.getChannelData(0),r=0;t>r;r++)n[r]=2*Math.random()-1;return i.type="white",i}(),i=function(){var r,o,a,s,l,u,h,t=2*e.audiocontext.sampleRate,i=e.audiocontext.createBuffer(1,t,e.audiocontext.sampleRate),n=i.getChannelData(0);r=o=a=s=l=u=h=0;for(var c=0;t>c;c++){var f=2*Math.random()-1;r=.99886*r+.0555179*f,o=.99332*o+.0750759*f,a=.969*a+.153852*f,s=.8665*s+.3104856*f,l=.55*l+.5329522*f,u=-.7616*u-.016898*f,n[c]=r+o+a+s+l+u+h+.5362*f,n[c]*=.11,h=.115926*f}return i.type="pink",i}(),n=function(){for(var t=2*e.audiocontext.sampleRate,i=e.audiocontext.createBuffer(1,t,e.audiocontext.sampleRate),n=i.getChannelData(0),r=0,o=0;t>o;o++){var a=2*Math.random()-1;n[o]=(r+.02*a)/1.02,r=n[o],n[o]*=3.5}return i.type="brown",i}();p5.Noise.prototype.setType=function(r){switch(r){case"white":this.buffer=t;break;case"pink":this.buffer=i;break;case"brown":this.buffer=n;break;default:this.buffer=t}if(this.started){var o=e.audiocontext.currentTime;this.stop(o),this.start(o+.01)}},p5.Noise.prototype.getType=function(){return this.buffer.type},p5.Noise.prototype.start=function(){this.started&&this.stop(),this.noise=e.audiocontext.createBufferSource(),this.noise.buffer=this.buffer,this.noise.loop=!0,this.noise.connect(this.output);var t=e.audiocontext.currentTime;this.noise.start(t),this.started=!0},p5.Noise.prototype.stop=function(){var t=e.audiocontext.currentTime;this.noise&&(this.noise.stop(t),this.started=!1)},p5.Noise.prototype.dispose=function(){var t=e.audiocontext.currentTime,i=e.soundArray.indexOf(this);e.soundArray.splice(i,1),this.noise&&(this.noise.disconnect(),this.stop(t)),this.output&&this.output.disconnect(),this.panner&&this.panner.disconnect(),this.output=null,this.panner=null,this.buffer=null,this.noise=null}}(master);var audioin;audioin=function(){"use strict";var e=master;p5.AudioIn=function(t){this.input=e.audiocontext.createGain(),this.output=e.audiocontext.createGain(),this.stream=null,this.mediaStream=null,this.currentSource=0,this.enabled=!1,this.amplitude=new p5.Amplitude,this.output.connect(this.amplitude.input),"undefined"==typeof window.MediaStreamTrack?t?t():window.alert("This browser does not support AudioIn"):"function"==typeof window.MediaStreamTrack.getSources&&window.MediaStreamTrack.getSources(this._gotSources),e.soundArray.push(this)},p5.AudioIn.prototype.start=function(t,i){var n=this;if(e.inputSources[n.currentSource]){var r=e.inputSources[n.currentSource].id,o={audio:{optional:[{sourceId:r}]}};window.navigator.getUserMedia(o,this._onStream=function(i){n.stream=i,n.enabled=!0,n.mediaStream=e.audiocontext.createMediaStreamSource(i),n.mediaStream.connect(n.output),t&&t(),n.amplitude.setInput(n.output)},this._onStreamError=function(e){i?i(e):console.error(e)})}else window.navigator.getUserMedia({audio:!0},this._onStream=function(i){n.stream=i,n.enabled=!0,n.mediaStream=e.audiocontext.createMediaStreamSource(i),n.mediaStream.connect(n.output),n.amplitude.setInput(n.output),t&&t()},this._onStreamError=function(e){i?i(e):console.error(e)})},p5.AudioIn.prototype.stop=function(){this.stream&&this.stream.getTracks()[0].stop()},p5.AudioIn.prototype.connect=function(t){t?t.hasOwnProperty("input")?this.output.connect(t.input):t.hasOwnProperty("analyser")?this.output.connect(t.analyser):this.output.connect(t):this.output.connect(e.input)},p5.AudioIn.prototype.disconnect=function(){this.output.disconnect(),this.output.connect(this.amplitude.input)},p5.AudioIn.prototype.getLevel=function(e){return e&&(this.amplitude.smoothing=e),this.amplitude.getLevel()},p5.AudioIn.prototype._gotSources=function(e){for(var t=0;t<e.length;t++){var i=e[t];if("audio"===i.kind)return i}},p5.AudioIn.prototype.amp=function(t,i){if(i){var n=i||0,r=this.output.gain.value;this.output.gain.cancelScheduledValues(e.audiocontext.currentTime),this.output.gain.setValueAtTime(r,e.audiocontext.currentTime),this.output.gain.linearRampToValueAtTime(t,n+e.audiocontext.currentTime)}else this.output.gain.cancelScheduledValues(e.audiocontext.currentTime),this.output.gain.setValueAtTime(t,e.audiocontext.currentTime)},p5.AudioIn.prototype.listSources=function(){return console.log("listSources is deprecated - please use AudioIn.getSources"),console.log("input sources: "),e.inputSources.length>0?e.inputSources:"This browser does not support MediaStreamTrack.getSources()"},p5.AudioIn.prototype.getSources=function(t){"function"==typeof window.MediaStreamTrack.getSources?window.MediaStreamTrack.getSources(function(i){for(var n=0,r=i.length;r>n;n++){var o=i[n];"audio"===o.kind&&e.inputSources.push(o)}t(e.inputSources)}):console.log("This browser does not support MediaStreamTrack.getSources()")},p5.AudioIn.prototype.setSource=function(t){var i=this;e.inputSources.length>0&&t<e.inputSources.length?(i.currentSource=t,console.log("set source to "+e.inputSources[i.currentSource].id)):console.log("unable to set input source")},p5.AudioIn.prototype.dispose=function(){var t=e.soundArray.indexOf(this);e.soundArray.splice(t,1),this.stop(),this.output&&this.output.disconnect(),this.amplitude&&this.amplitude.disconnect(),this.amplitude=null,this.output=null}}(master,errorHandler);var filter;filter=function(){"use strict";var e=master;p5.Filter=function(t){this.ac=e.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.biquad=this.ac.createBiquadFilter(),this.input.connect(this.biquad),this.biquad.connect(this.output),this.connect(),t&&this.setType(t),e.soundArray.push(this)},p5.Filter.prototype.process=function(e,t,i){e.connect(this.input),this.set(t,i)},p5.Filter.prototype.set=function(e,t,i){e&&this.freq(e,i),t&&this.res(t,i)},p5.Filter.prototype.freq=function(e,t){var i=this,n=t||0;return 0>=e&&(e=1),"number"==typeof e?(i.biquad.frequency.value=e,i.biquad.frequency.cancelScheduledValues(this.ac.currentTime+.01+n),i.biquad.frequency.exponentialRampToValueAtTime(e,this.ac.currentTime+.02+n)):e&&e.connect(this.biquad.frequency),i.biquad.frequency.value},p5.Filter.prototype.res=function(e,t){var i=this,n=t||0;return"number"==typeof e?(i.biquad.Q.value=e,i.biquad.Q.cancelScheduledValues(i.ac.currentTime+.01+n),i.biquad.Q.linearRampToValueAtTime(e,i.ac.currentTime+.02+n)):e&&freq.connect(this.biquad.Q),i.biquad.Q.value},p5.Filter.prototype.setType=function(e){this.biquad.type=e},p5.Filter.prototype.amp=function(t,i,n){var i=i||0,n=n||0,r=e.audiocontext.currentTime,o=this.output.gain.value;this.output.gain.cancelScheduledValues(r),this.output.gain.linearRampToValueAtTime(o,r+n+.001),this.output.gain.linearRampToValueAtTime(t,r+n+i+.001)},p5.Filter.prototype.connect=function(e){var t=e||p5.soundOut.input;this.output.connect(t)},p5.Filter.prototype.disconnect=function(){this.output.disconnect()},p5.Filter.prototype.dispose=function(){var t=e.soundArray.indexOf(this);e.soundArray.splice(t,1),this.input.disconnect(),this.input=void 0,this.output.disconnect(),this.output=void 0,this.biquad.disconnect(),this.biquad=void 0},p5.LowPass=function(){p5.Filter.call(this,"lowpass")},p5.LowPass.prototype=Object.create(p5.Filter.prototype),p5.HighPass=function(){p5.Filter.call(this,"highpass")},p5.HighPass.prototype=Object.create(p5.Filter.prototype),p5.BandPass=function(){p5.Filter.call(this,"bandpass")},p5.BandPass.prototype=Object.create(p5.Filter.prototype)}(master);var delay;delay=function(){"use strict";var e=master;p5.Delay=function(){this.ac=e.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this._split=this.ac.createChannelSplitter(2),this._merge=this.ac.createChannelMerger(2),this._leftGain=this.ac.createGain(),this._rightGain=this.ac.createGain(),this.leftDelay=this.ac.createDelay(),this.rightDelay=this.ac.createDelay(),this._leftFilter=new p5.Filter,this._rightFilter=new p5.Filter,this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._leftFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime),this._rightFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime),this._leftFilter.biquad.Q.setValueAtTime(.3,this.ac.currentTime),this._rightFilter.biquad.Q.setValueAtTime(.3,this.ac.currentTime),this.input.connect(this._split),this.leftDelay.connect(this._leftGain),this.rightDelay.connect(this._rightGain),this._leftGain.connect(this._leftFilter.input),this._rightGain.connect(this._rightFilter.input),this._merge.connect(this.output),this.output.connect(p5.soundOut.input),this._leftFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime),this._rightFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime),this.setType(0),this._maxDelay=this.leftDelay.delayTime.maxValue,e.soundArray.push(this)},p5.Delay.prototype.process=function(e,t,i,n){var r=i||0,o=t||0;if(r>=1)throw new Error("Feedback value will force a positive feedback loop.");if(o>=this._maxDelay)throw new Error("Delay Time exceeds maximum delay time of "+this._maxDelay+" second.");e.connect(this.input),this.leftDelay.delayTime.setValueAtTime(o,this.ac.currentTime),this.rightDelay.delayTime.setValueAtTime(o,this.ac.currentTime),this._leftGain.gain.setValueAtTime(r,this.ac.currentTime),this._rightGain.gain.setValueAtTime(r,this.ac.currentTime),n&&(this._leftFilter.freq(n),this._rightFilter.freq(n))},p5.Delay.prototype.delayTime=function(e){"number"!=typeof e?(e.connect(this.leftDelay.delayTime),e.connect(this.rightDelay.delayTime)):(this.leftDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.rightDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.leftDelay.delayTime.linearRampToValueAtTime(e,this.ac.currentTime),this.rightDelay.delayTime.linearRampToValueAtTime(e,this.ac.currentTime))},p5.Delay.prototype.feedback=function(e){if("number"!=typeof e)e.connect(this._leftGain.gain),e.connect(this._rightGain.gain);else{if(e>=1)throw new Error("Feedback value will force a positive feedback loop.");this._leftGain.gain.exponentialRampToValueAtTime(e,this.ac.currentTime),this._rightGain.gain.exponentialRampToValueAtTime(e,this.ac.currentTime)}},p5.Delay.prototype.filter=function(e,t){this._leftFilter.set(e,t),this._rightFilter.set(e,t)},p5.Delay.prototype.setType=function(e){switch(1===e&&(e="pingPong"),this._split.disconnect(),this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._split.connect(this.leftDelay,0),this._split.connect(this.rightDelay,1),e){case"pingPong":this._rightFilter.setType(this._leftFilter.biquad.type),this._leftFilter.output.connect(this._merge,0,0),this._rightFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.rightDelay),this._rightFilter.output.connect(this.leftDelay);break;default:this._leftFilter.output.connect(this._merge,0,0),this._leftFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.leftDelay),this._leftFilter.output.connect(this.rightDelay)}},p5.Delay.prototype.amp=function(t,i,n){var i=i||0,n=n||0,r=e.audiocontext.currentTime,o=this.output.gain.value;this.output.gain.cancelScheduledValues(r),this.output.gain.linearRampToValueAtTime(o,r+n+.001),this.output.gain.linearRampToValueAtTime(t,r+n+i+.001)},p5.Delay.prototype.connect=function(e){var t=e||p5.soundOut.input;this.output.connect(t)},p5.Delay.prototype.disconnect=function(){this.output.disconnect()},p5.Delay.prototype.dispose=function(){var t=e.soundArray.indexOf(this);e.soundArray.splice(t,1),this.input.disconnect(),this.output.disconnect(),this._split.disconnect(),this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._merge.disconnect(),this._leftGain.disconnect(),this._rightGain.disconnect(),this.leftDelay.disconnect(),this.rightDelay.disconnect(),this.input=void 0,this.output=void 0,this._split=void 0,this._leftFilter=void 0,this._rightFilter=void 0,this._merge=void 0,this._leftGain=void 0,this._rightGain=void 0,this.leftDelay=void 0,this.rightDelay=void 0}}(master,filter);var reverb;reverb=function(){"use strict";var e=master,t=errorHandler;p5.Reverb=function(){this.ac=e.audiocontext,this.convolverNode=this.ac.createConvolver(),this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.convolverNode),this.convolverNode.connect(this.output),this._seconds=3,this._decay=2,this._reverse=!1,this._buildImpulse(),this.connect(),e.soundArray.push(this)},p5.Reverb.prototype.process=function(e,t,i,n){e.connect(this.input);var r=!1;t&&(this._seconds=t,r=!0),i&&(this._decay=i),n&&(this._reverse=n),r&&this._buildImpulse()},p5.Reverb.prototype.set=function(e,t,i){var n=!1;e&&(this._seconds=e,n=!0),t&&(this._decay=t),i&&(this._reverse=i),n&&this._buildImpulse()},p5.Reverb.prototype.amp=function(t,i,n){var i=i||0,n=n||0,r=e.audiocontext.currentTime,o=this.output.gain.value;this.output.gain.cancelScheduledValues(r),this.output.gain.linearRampToValueAtTime(o,r+n+.001),this.output.gain.linearRampToValueAtTime(t,r+n+i+.001)},p5.Reverb.prototype.connect=function(e){var t=e||p5.soundOut.input;this.output.connect(t.input?t.input:t)},p5.Reverb.prototype.disconnect=function(){this.output.disconnect()},p5.Reverb.prototype._buildImpulse=function(){var a,s,e=this.ac.sampleRate,t=e*this._seconds,i=this._decay,n=this.ac.createBuffer(2,t,e),r=n.getChannelData(0),o=n.getChannelData(1);for(s=0;t>s;s++)a=this.reverse?t-s:s,r[s]=(2*Math.random()-1)*Math.pow(1-a/t,i),o[s]=(2*Math.random()-1)*Math.pow(1-a/t,i);this.convolverNode.buffer=n},p5.Reverb.prototype.dispose=function(){var t=e.soundArray.indexOf(this);e.soundArray.splice(t,1),this.convolverNode&&(this.convolverNode.buffer=null,this.convolverNode=null),"undefined"!=typeof this.output&&(this.output.disconnect(),this.output=null),"undefined"!=typeof this.panner&&(this.panner.disconnect(),this.panner=null)},p5.Convolver=function(t,i,n){this.ac=e.audiocontext,this.convolverNode=this.ac.createConvolver(),this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.convolverNode),this.convolverNode.connect(this.output),t?(this.impulses=[],this._loadBuffer(t,i,n)):(this._seconds=3,this._decay=2,this._reverse=!1,this._buildImpulse()),this.connect(),e.soundArray.push(this)},p5.Convolver.prototype=Object.create(p5.Reverb.prototype),p5.prototype.registerPreloadMethod("createConvolver",p5.prototype),p5.prototype.createConvolver=function(e,t,i){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var n=new p5.Convolver(e,t,i);return n.impulses=[],n},p5.Convolver.prototype._loadBuffer=function(e,i,n){var e=p5.prototype._checkFileFormats(e),r=this,o=(new Error).stack,a=p5.prototype.getAudioContext(),s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=function(){if(200==s.status)a.decodeAudioData(s.response,function(t){var n={},o=e.split("/");n.name=o[o.length-1],n.audioBuffer=t,r.impulses.push(n),r.convolverNode.buffer=n.audioBuffer,i&&i(n)},function(e){var i=new t("decodeAudioData",o,r.url),a="AudioContext error at decodeAudioData for "+r.url;n?(i.msg=a,n(i)):console.error(a+"\n The error stack trace includes: \n"+i.stack)});else{var l=new t("loadConvolver",o,r.url),u="Unable to load "+r.url+". The request status was: "+s.status+" ("+s.statusText+")";n?(l.message=u,n(l)):console.error(u+"\n The error stack trace includes: \n"+l.stack)}},s.onerror=function(e){var i=new t("loadConvolver",o,r.url),a="There was no response from the server at "+r.url+". Check the url and internet connectivity.";n?(i.message=a,n(i)):console.error(a+"\n The error stack trace includes: \n"+i.stack)},s.send()},p5.Convolver.prototype.set=null,p5.Convolver.prototype.process=function(e){e.connect(this.input)},p5.Convolver.prototype.impulses=[],p5.Convolver.prototype.addImpulse=function(e,t,i){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this._loadBuffer(e,t,i)},p5.Convolver.prototype.resetImpulse=function(e,t,i){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this.impulses=[],this._loadBuffer(e,t,i)},p5.Convolver.prototype.toggleImpulse=function(e){if("number"==typeof e&&e<this.impulses.length&&(this.convolverNode.buffer=this.impulses[e].audioBuffer),"string"==typeof e)for(var t=0;t<this.impulses.length;t++)if(this.impulses[t].name===e){this.convolverNode.buffer=this.impulses[t].audioBuffer;break}},p5.Convolver.prototype.dispose=function(){for(var e in this.impulses)this.impulses[e]=null;this.convolverNode.disconnect(),this.concolverNode=null,"undefined"!=typeof this.output&&(this.output.disconnect(),this.output=null),"undefined"!=typeof this.panner&&(this.panner.disconnect(),this.panner=null)}}(master,errorHandler,sndcore);var Tone_core_TimelineState;Tone_core_TimelineState=function(e){"use strict";return e.TimelineState=function(t){e.Timeline.call(this),this._initial=t},e.extend(e.TimelineState,e.Timeline),e.TimelineState.prototype.getStateAtTime=function(e){var t=this.getEvent(e);return null!==t?t.state:this._initial},e.TimelineState.prototype.setStateAtTime=function(e,t){this.addEvent({state:e,time:this.toSeconds(t)})},e.TimelineState}(Tone_core_Tone,Tone_core_Timeline);var Tone_core_Clock;Tone_core_Clock=function(e){"use strict";return e.Clock=function(){var t=this.optionsObject(arguments,["callback","frequency"],e.Clock.defaults);this.callback=t.callback,this._lookAhead="auto",this._computedLookAhead=1/60,this._threshold=.5,this._nextTick=-1,this._lastUpdate=0,this._loopID=-1,this.frequency=new e.TimelineSignal(t.frequency,e.Type.Frequency),this.ticks=0,this._state=new e.TimelineState(e.State.Stopped),this._boundLoop=this._loop.bind(this),this._readOnly("frequency"),this._loop()},e.extend(e.Clock),e.Clock.defaults={callback:e.noOp,frequency:1,lookAhead:"auto"},Object.defineProperty(e.Clock.prototype,"state",{get:function(){return this._state.getStateAtTime(this.now())}}),Object.defineProperty(e.Clock.prototype,"lookAhead",{get:function(){return this._lookAhead},set:function(e){"auto"===e?this._lookAhead="auto":this._lookAhead=this.toSeconds(e)}}),e.Clock.prototype.start=function(t,i){return t=this.toSeconds(t),this._state.getStateAtTime(t)!==e.State.Started&&this._state.addEvent({state:e.State.Started,time:t,offset:i}),this},e.Clock.prototype.stop=function(t){return t=this.toSeconds(t),this._state.getStateAtTime(t)!==e.State.Stopped&&this._state.setStateAtTime(e.State.Stopped,t),this},e.Clock.prototype.pause=function(t){return t=this.toSeconds(t),this._state.getStateAtTime(t)===e.State.Started&&this._state.setStateAtTime(e.State.Paused,t),this},e.Clock.prototype._loop=function(t){if(this._loopID=requestAnimationFrame(this._boundLoop),"auto"===this._lookAhead){if(!this.isUndef(t)){var i=(t-this._lastUpdate)/1e3;this._lastUpdate=t,i<this._threshold&&(this._computedLookAhead=(9*this._computedLookAhead+i)/10)}}else this._computedLookAhead=this._lookAhead;var n=this.now(),r=2*this._computedLookAhead,o=this._state.getEvent(n+r),a=e.State.Stopped;if(o&&(a=o.state,-1===this._nextTick&&a===e.State.Started&&(this._nextTick=o.time,this.isUndef(o.offset)||(this.ticks=o.offset))),a===e.State.Started)for(;n+r>this._nextTick;){n>this._nextTick+this._threshold&&(this._nextTick=n);var s=this._nextTick;this._nextTick+=1/this.frequency.getValueAtTime(this._nextTick),this.callback(s),this.ticks++}else a===e.State.Stopped&&(this._nextTick=-1,this.ticks=0)},e.Clock.prototype.getStateAtTime=function(e){return this._state.getStateAtTime(e)},e.Clock.prototype.dispose=function(){
cancelAnimationFrame(this._loopID),e.TimelineState.prototype.dispose.call(this),this._writable("frequency"),this.frequency.dispose(),this.frequency=null,this._boundLoop=e.noOp,this._nextTick=1/0,this.callback=null,this._state.dispose(),this._state=null},e.Clock}(Tone_core_Tone,Tone_signal_TimelineSignal);var metro;metro=function(){"use strict";var e=master,t=Tone_core_Clock;e.audiocontext;p5.Metro=function(){this.clock=new t({callback:this.ontick.bind(this)}),this.syncedParts=[],this.bpm=120,this._init(),this.tickCallback=function(){}};var n=0,r=0;p5.Metro.prototype.ontick=function(t){var i=t-n,o=t-e.audiocontext.currentTime;if(!(-.02>=i-r)){n=t;for(var a in this.syncedParts){var s=this.syncedParts[a];if(!s.isPlaying)return;s.incrementStep(o);for(var l in s.phrases){var u=s.phrases[l],h=u.sequence,c=this.metroTicks%h.length;0!==h[c]&&(this.metroTicks<h.length||!u.looping)&&u.callback(o,h[c])}}this.metroTicks+=1,this.tickCallback(o)}},p5.Metro.prototype.setBPM=function(t,i){var n=60/(t*this.tatums),o=e.audiocontext.currentTime;r=n;var i=i||0;this.clock.frequency.setValueAtTime(this.clock.frequency.value,o),this.clock.frequency.linearRampToValueAtTime(t,o+i),this.bpm=t},p5.Metro.prototype.getBPM=function(e){return this.clock.getRate()/this.tatums*60},p5.Metro.prototype._init=function(){this.metroTicks=0},p5.Metro.prototype.resetSync=function(e){this.syncedParts=[e]},p5.Metro.prototype.pushSync=function(e){this.syncedParts.push(e)},p5.Metro.prototype.start=function(t){var i=t||0,n=e.audiocontext.currentTime;this.clock.start(n+i),this.setBPM(this.bpm)},p5.Metro.prototype.stop=function(t){var i=t||0,n=e.audiocontext.currentTime;this.clock._oscillator&&this.clock.stop(n+i)},p5.Metro.prototype.beatLength=function(e){this.tatums=1/e/4}}(master,Tone_core_Clock);var looper;looper=function(){"use strict";function i(e){e.currentPart++,e.currentPart>=e.parts.length?(e.scoreStep=0,e.onended()):(e.scoreStep=0,e.parts[e.currentPart-1].stop(),e.parts[e.currentPart].start())}var e=master,t=120;p5.prototype.setBPM=function(i,n){t=i;for(var r in e.parts)e.parts[r].setBPM(t,n)},p5.Phrase=function(e,t,i){this.phraseStep=0,this.name=e,this.callback=t,this.sequence=i},p5.Part=function(i,n){this.length=i||0,this.partStep=0,this.phrases=[],this.isPlaying=!1,this.noLoop(),this.tatums=n||.0625,this.metro=new p5.Metro,this.metro._init(),this.metro.beatLength(this.tatums),this.metro.setBPM(t),e.parts.push(this),this.callback=function(){}},p5.Part.prototype.setBPM=function(e,t){this.metro.setBPM(e,t)},p5.Part.prototype.getBPM=function(){return this.metro.getBPM()},p5.Part.prototype.start=function(e){if(!this.isPlaying){this.isPlaying=!0,this.metro.resetSync(this);var t=e||0;this.metro.start(t)}},p5.Part.prototype.loop=function(e){this.looping=!0,this.onended=function(){this.partStep=0};var t=e||0;this.start(t)},p5.Part.prototype.noLoop=function(){this.looping=!1,this.onended=function(){this.stop()}},p5.Part.prototype.stop=function(e){this.partStep=0,this.pause(e)},p5.Part.prototype.pause=function(e){this.isPlaying=!1;var t=e||0;this.metro.stop(t)},p5.Part.prototype.addPhrase=function(e,t,i){var n;if(3===arguments.length)n=new p5.Phrase(e,t,i);else{if(!(arguments[0]instanceof p5.Phrase))throw"invalid input. addPhrase accepts name, callback, array or a p5.Phrase";n=arguments[0]}this.phrases.push(n),n.sequence.length>this.length&&(this.length=n.sequence.length)},p5.Part.prototype.removePhrase=function(e){for(var t in this.phrases)this.phrases[t].name===e&&this.phrases.splice(t,1)},p5.Part.prototype.getPhrase=function(e){for(var t in this.phrases)if(this.phrases[t].name===e)return this.phrases[t]},p5.Part.prototype.replaceSequence=function(e,t){for(var i in this.phrases)this.phrases[i].name===e&&(this.phrases[i].sequence=t)},p5.Part.prototype.incrementStep=function(e){this.partStep<this.length-1?(this.callback(e),this.partStep+=1):this.looping||this.partStep!=this.length-1||(console.log("done"),this.onended())},p5.Part.prototype.onStep=function(e){this.callback=e},p5.Score=function(){this.parts=[],this.currentPart=0;var e=this;for(var t in arguments)this.parts[t]=arguments[t],this.parts[t].nextPart=this.parts[t+1],this.parts[t].onended=function(){e.resetPart(t),i(e)};this.looping=!1},p5.Score.prototype.onended=function(){this.looping?this.parts[0].start():this.parts[this.parts.length-1].onended=function(){this.stop(),this.resetParts()},this.currentPart=0},p5.Score.prototype.start=function(){this.parts[this.currentPart].start(),this.scoreStep=0},p5.Score.prototype.stop=function(){this.parts[this.currentPart].stop(),this.currentPart=0,this.scoreStep=0},p5.Score.prototype.pause=function(){this.parts[this.currentPart].stop()},p5.Score.prototype.loop=function(){this.looping=!0,this.start()},p5.Score.prototype.noLoop=function(){this.looping=!1},p5.Score.prototype.resetParts=function(){for(var e in this.parts)this.resetPart(e)},p5.Score.prototype.resetPart=function(e){this.parts[e].stop(),this.parts[e].partStep=0;for(var t in this.parts[e].phrases)this.parts[e].phrases[t].phraseStep=0},p5.Score.prototype.setBPM=function(e,t){for(var i in this.parts)this.parts[i].setBPM(e,t)}}(master);var soundRecorder;soundRecorder=function(){"use strict";function i(e,t){for(var i=e.length+t.length,n=new Float32Array(i),r=0,o=0;i>o;)n[o++]=e[r],n[o++]=t[r],r++;return n}function n(e,t,i){for(var n=i.length,r=0;n>r;r++)e.setUint8(t+r,i.charCodeAt(r))}var e=master,t=e.audiocontext;p5.SoundRecorder=function(){this.input=t.createGain(),this.output=t.createGain(),this.recording=!1,this.bufferSize=1024,this._channels=2,this._clear(),this._jsNode=t.createScriptProcessor(this.bufferSize,this._channels,2),this._jsNode.onaudioprocess=this._audioprocess.bind(this),this._callback=function(){},this._jsNode.connect(p5.soundOut._silentNode),this.setInput(),e.soundArray.push(this)},p5.SoundRecorder.prototype.setInput=function(e){this.input.disconnect(),this.input=null,this.input=t.createGain(),this.input.connect(this._jsNode),this.input.connect(this.output),e?e.connect(this.input):p5.soundOut.output.connect(this.input)},p5.SoundRecorder.prototype.record=function(e,i,n){this.recording=!0,i&&(this.sampleLimit=Math.round(i*t.sampleRate)),e&&n?this._callback=function(){this.buffer=this._getBuffer(),e.setBuffer(this.buffer),n()}:e&&(this._callback=function(){this.buffer=this._getBuffer(),e.setBuffer(this.buffer)})},p5.SoundRecorder.prototype.stop=function(){this.recording=!1,this._callback(),this._clear()},p5.SoundRecorder.prototype._clear=function(){this._leftBuffers=[],this._rightBuffers=[],this.recordedSamples=0,this.sampleLimit=null},p5.SoundRecorder.prototype._audioprocess=function(e){if(this.recording!==!1&&this.recording===!0)if(this.sampleLimit&&this.recordedSamples>=this.sampleLimit)this.stop();else{var t=e.inputBuffer.getChannelData(0),i=e.inputBuffer.getChannelData(1);this._leftBuffers.push(new Float32Array(t)),this._rightBuffers.push(new Float32Array(i)),this.recordedSamples+=this.bufferSize}},p5.SoundRecorder.prototype._getBuffer=function(){var e=[];return e.push(this._mergeBuffers(this._leftBuffers)),e.push(this._mergeBuffers(this._rightBuffers)),e},p5.SoundRecorder.prototype._mergeBuffers=function(e){for(var t=new Float32Array(this.recordedSamples),i=0,n=e.length,r=0;n>r;r++){var o=e[r];t.set(o,i),i+=o.length}return t},p5.SoundRecorder.prototype.dispose=function(){this._clear();var t=e.soundArray.indexOf(this);e.soundArray.splice(t,1),this._callback=function(){},this.input&&this.input.disconnect(),this.input=null,this._jsNode=null},p5.prototype.saveSound=function(e,t){var r,o;r=e.buffer.getChannelData(0),o=e.buffer.numberOfChannels>1?e.buffer.getChannelData(1):r;var a=i(r,o),s=new ArrayBuffer(44+2*a.length),l=new DataView(s);n(l,0,"RIFF"),l.setUint32(4,36+2*a.length,!0),n(l,8,"WAVE"),n(l,12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,1,!0),l.setUint16(22,2,!0),l.setUint32(24,44100,!0),l.setUint32(28,176400,!0),l.setUint16(32,4,!0),l.setUint16(34,16,!0),n(l,36,"data"),l.setUint32(40,2*a.length,!0);for(var u=a.length,h=44,c=1,f=0;u>f;f++)l.setInt16(h,a[f]*(32767*c),!0),h+=2;p5.prototype.writeFile([l],t,"wav")}}(sndcore,master);var peakdetect;peakdetect=function(){"use strict";p5.PeakDetect=function(e,t,i,n){this.framesPerPeak=n||20,this.framesSinceLastPeak=0,this.decayRate=.95,this.threshold=i||.35,this.cutoff=0,this.cutoffMult=1.5,this.energy=0,this.penergy=0,this.currentValue=0,this.isDetected=!1,this.f1=e||40,this.f2=t||2e4,this._onPeak=function(){}},p5.PeakDetect.prototype.update=function(e){var t=this.energy=e.getEnergy(this.f1,this.f2)/255;t>this.cutoff&&t>this.threshold&&t-this.penergy>0?(this._onPeak(),this.isDetected=!0,this.cutoff=t*this.cutoffMult,this.framesSinceLastPeak=0):(this.isDetected=!1,this.framesSinceLastPeak<=this.framesPerPeak?this.framesSinceLastPeak++:(this.cutoff*=this.decayRate,this.cutoff=Math.max(this.cutoff,this.threshold))),this.currentValue=t,this.penergy=t},p5.PeakDetect.prototype.onPeak=function(e,t){var i=this;i._onPeak=function(){e(i.energy,t)}}}(master);var gain;gain=function(){"use strict";var e=master;p5.Gain=function(){this.ac=e.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.output),e.soundArray.push(this)},p5.Gain.prototype.setInput=function(e){e.connect(this.input)},p5.Gain.prototype.connect=function(e){var t=e||p5.soundOut.input;this.output.connect(t.input?t.input:t)},p5.Gain.prototype.disconnect=function(){this.output.disconnect()},p5.Gain.prototype.amp=function(t,i,n){var i=i||0,n=n||0,r=e.audiocontext.currentTime,o=this.output.gain.value;this.output.gain.cancelScheduledValues(r),this.output.gain.linearRampToValueAtTime(o,r+n),this.output.gain.linearRampToValueAtTime(t,r+n+i)},p5.Gain.prototype.dispose=function(){var t=e.soundArray.indexOf(this);e.soundArray.splice(t,1),this.output.disconnect(),this.input.disconnect(),this.output=void 0,this.input=void 0}}(master,sndcore);var distortion;distortion=function(){"use strict";function t(e){for(var a,t="number"==typeof e?e:50,i=44100,n=new Float32Array(i),r=Math.PI/180,o=0;i>o;++o)a=2*o/i-1,n[o]=(3+t)*a*20*r/(Math.PI+t*Math.abs(a));return n}var e=master;p5.Distortion=function(i,n){if("undefined"==typeof i&&(i=.25),"number"!=typeof i)throw new Error("amount must be a number");if("undefined"==typeof n&&(n="2x"),"string"!=typeof n)throw new Error("oversample must be a String");var r=p5.prototype.map(i,0,1,0,2e3);this.ac=e.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.waveShaperNode=this.ac.createWaveShaper(),this.amount=r,this.waveShaperNode.curve=t(r),this.waveShaperNode.oversample=n,this.input.connect(this.waveShaperNode),this.waveShaperNode.connect(this.output),this.connect(),e.soundArray.push(this)},p5.Distortion.prototype.process=function(e,t,i){e.connect(this.input),this.set(t,i)},p5.Distortion.prototype.set=function(e,i){if(e){var n=p5.prototype.map(e,0,1,0,2e3);this.amount=n,this.waveShaperNode.curve=t(n)}i&&(this.waveShaperNode.oversample=i)},p5.Distortion.prototype.getAmount=function(){return this.amount},p5.Distortion.prototype.getOversample=function(){return this.waveShaperNode.oversample},p5.Distortion.prototype.connect=function(e){var t=e||p5.soundOut.input;this.output.connect(t)},p5.Distortion.prototype.disconnect=function(){this.output.disconnect()},p5.Distortion.prototype.dispose=function(){var t=e.soundArray.indexOf(this);e.soundArray.splice(t,1),this.input.disconnect(),this.waveShaperNode.disconnect(),this.input=null,this.waveShaperNode=null,"undefined"!=typeof this.output&&(this.output.disconnect(),this.output=null)}}(master);var src_app;src_app=function(){"use strict";var e=sndcore;return e}(sndcore,master,helpers,errorHandler,panner,soundfile,amplitude,fft,signal,oscillator,env,pulse,noise,audioin,filter,delay,reverb,metro,looper,soundRecorder,peakdetect,gain,distortion)});